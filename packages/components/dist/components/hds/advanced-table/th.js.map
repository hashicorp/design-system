{"version":3,"file":"th.js","sources":["../../../../src/components/hds/advanced-table/th.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport Component from '@glimmer/component';\nimport { guidFor } from '@ember/object/internals';\nimport { assert } from '@ember/debug';\nimport { action } from '@ember/object';\nimport { tracked } from '@glimmer/tracking';\nimport { focusable, type FocusableElement } from 'tabbable';\nimport { modifier } from 'ember-modifier';\nimport HdsAdvancedTableColumn from './models/column.ts';\nimport { onFocusTrapDeactivate } from '../../../modifiers/hds-advanced-table-cell/dom-management.ts';\nimport { HdsAdvancedTableHorizontalAlignmentValues } from './types.ts';\n\nimport type Owner from '@ember/owner';\nimport type {\n  HdsAdvancedTableHorizontalAlignment,\n  HdsAdvancedTableScope,\n  HdsAdvancedTableExpandState,\n} from './types.ts';\nimport type { HdsAdvancedTableSignature } from './index.ts';\nimport type { HdsAdvancedTableThResizeHandleSignature } from './th-resize-handle.ts';\n\nexport const ALIGNMENTS: string[] = Object.values(\n  HdsAdvancedTableHorizontalAlignmentValues\n);\nexport const DEFAULT_ALIGN = HdsAdvancedTableHorizontalAlignmentValues.Left;\n\nexport interface HdsAdvancedTableThSignature {\n  Args: {\n    align?: HdsAdvancedTableHorizontalAlignment;\n    column?: HdsAdvancedTableColumn;\n    colspan?: number;\n    depth?: number;\n    hasExpandAllButton?: boolean;\n    hasResizableColumns?: boolean;\n    isExpanded?: HdsAdvancedTableExpandState;\n    isExpandable?: boolean;\n    isStickyColumn?: boolean;\n    isStickyColumnPinned?: boolean;\n    isVisuallyHidden?: boolean;\n    newLabel?: string;\n    parentId?: string;\n    rowspan?: number;\n    scope?: HdsAdvancedTableScope;\n    tooltip?: string;\n    tableHeight?: number;\n    didInsertExpandButton?: (button: HTMLButtonElement) => void;\n    onClickToggle?: () => void;\n    onColumnResize?: HdsAdvancedTableSignature['Args']['onColumnResize'];\n    willDestroyExpandButton?: (button: HTMLButtonElement) => void;\n  };\n  Blocks: {\n    default?: [];\n  };\n  Element: HTMLDivElement;\n}\n\nexport default class HdsAdvancedTableTh extends Component<HdsAdvancedTableThSignature> {\n  private _labelId = this.args.newLabel ? this.args.newLabel : guidFor(this);\n  private _element!: HTMLDivElement;\n\n  @tracked private _shouldTrapFocus = false;\n  @tracked\n  private _resizeHandleElement?: HdsAdvancedTableThResizeHandleSignature['Element'];\n\n  constructor(owner: Owner, args: HdsAdvancedTableThSignature['Args']) {\n    super(owner, args);\n\n    const { rowspan, colspan, isStickyColumn } = args;\n\n    if (isStickyColumn) {\n      assert(\n        'Cannot have custom rowspan or colspan if there are nested rows.',\n        rowspan === undefined || colspan === undefined\n      );\n    }\n  }\n\n  get scope(): HdsAdvancedTableScope {\n    const { scope = 'col' } = this.args;\n    return scope;\n  }\n\n  get role(): string {\n    if (this.scope === 'col') return 'columnheader';\n    else return 'rowheader';\n  }\n\n  get align(): HdsAdvancedTableHorizontalAlignment {\n    const { align = DEFAULT_ALIGN } = this.args;\n\n    assert(\n      `@align for \"Hds::Table::Th\" must be one of the following: ${ALIGNMENTS.join(\n        ', '\n      )}; received: ${align}`,\n      ALIGNMENTS.includes(align)\n    );\n\n    return align;\n  }\n\n  // rowspan and colspan have to return 'auto' if not defined because otherwise the style modifier sets grid-area: undefined on the cell, which breaks the grid styles\n  get rowspan(): string {\n    if (this.args.rowspan) {\n      return `span ${this.args.rowspan}`;\n    }\n    return 'auto';\n  }\n\n  get colspan(): string | undefined {\n    if (this.args.colspan) {\n      return `span ${this.args.colspan}`;\n    }\n    return 'auto';\n  }\n\n  get paddingLeft(): string | undefined {\n    if (this.args.depth) {\n      return `calc(${this.args.depth} * 32px + 16px)`;\n    }\n  }\n\n  get classNames(): string {\n    const classes = ['hds-advanced-table__th'];\n\n    // add a class based on the @align argument\n    if (this.align) {\n      classes.push(`hds-advanced-table__th--align-${this.align}`);\n    }\n\n    if (this.args.isStickyColumn) {\n      classes.push('hds-advanced-table__th--is-sticky-column');\n    }\n\n    if (this.args.isStickyColumn && this.args.isStickyColumnPinned) {\n      classes.push('hds-advanced-table__th--is-sticky-column-pinned');\n    }\n\n    return classes.join(' ');\n  }\n\n  get showContextMenu(): boolean {\n    const { hasResizableColumns } = this.args;\n\n    return hasResizableColumns ?? false;\n  }\n\n  @action onFocusTrapDeactivate(): void {\n    this._shouldTrapFocus = false;\n    onFocusTrapDeactivate(this._element);\n  }\n\n  @action enableFocusTrap(): void {\n    this._shouldTrapFocus = true;\n  }\n\n  @action getInitialFocus(): FocusableElement | undefined {\n    const cellFocusableElements = focusable(this._element);\n    return cellFocusableElements[0];\n  }\n\n  @action setElement(element: HTMLDivElement): void {\n    this._element = element;\n  }\n\n  private _registerResizeHandleElement = modifier(\n    (element: HdsAdvancedTableThResizeHandleSignature['Element']) => {\n      this._resizeHandleElement = element;\n    }\n  );\n\n  private _manageExpandButton = modifier((button: HTMLButtonElement) => {\n    const { didInsertExpandButton, willDestroyExpandButton } = this.args;\n    if (typeof didInsertExpandButton === 'function') {\n      didInsertExpandButton(button);\n    }\n\n    return () => {\n      if (typeof willDestroyExpandButton === 'function') {\n        willDestroyExpandButton(button);\n      }\n    };\n  });\n}\n"],"names":["ALIGNMENTS","Object","values","HdsAdvancedTableHorizontalAlignmentValues","DEFAULT_ALIGN","Left","HdsAdvancedTableTh","Component","_labelId","args","newLabel","guidFor","_element","g","prototype","tracked","i","void 0","constructor","owner","rowspan","colspan","isStickyColumn","assert","undefined","scope","role","align","join","includes","paddingLeft","depth","classNames","classes","push","isStickyColumnPinned","showContextMenu","hasResizableColumns","onFocusTrapDeactivate","_shouldTrapFocus","n","action","enableFocusTrap","getInitialFocus","cellFocusableElements","focusable","setElement","element","_registerResizeHandleElement","modifier","_resizeHandleElement","_manageExpandButton","button","didInsertExpandButton","willDestroyExpandButton","setComponentTemplate","TEMPLATE"],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;AAsBO,MAAMA,UAAoB,GAAGC,MAAM,CAACC,MAAM,CAC/CC,yCACF;AACaC,MAAAA,aAAa,GAAGD,yCAAyC,CAACE;AAgCxD,MAAMC,kBAAkB,SAASC,SAAS,CAA8B;AAC7EC,EAAAA,QAAQ,GAAG,IAAI,CAACC,IAAI,CAACC,QAAQ,GAAG,IAAI,CAACD,IAAI,CAACC,QAAQ,GAAGC,OAAO,CAAC,IAAI,CAAC;EAClEC,QAAQ;AAAkB,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,kBAAA,EAAA,CAEjCC,OAAO,CAAA,EAAA,YAAA;AAAA,MAAA,OAA4B,KAAK;AAAA,KAAA,CAAA;AAAA;AAAA,EAAA,iBAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,kBAAA,CAAA,EAAAC,MAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,sBAAA,EAAA,CACxCC,OAAO,CAAA,CAAA;AAAA;AAAA,EAAA,qBAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,sBAAA,CAAA,EAAAC,MAAA;AAGRC,EAAAA,WAAWA,CAACC,KAAY,EAAEV,IAAyC,EAAE;AACnE,IAAA,KAAK,CAACU,KAAK,EAAEV,IAAI,CAAC;IAElB,MAAM;MAAEW,OAAO;MAAEC,OAAO;AAAEC,MAAAA;AAAe,KAAC,GAAGb,IAAI;AAEjD,IAAA,IAAIa,cAAc,EAAE;MAClBC,MAAM,CACJ,iEAAiE,EACjEH,OAAO,KAAKI,SAAS,IAAIH,OAAO,KAAKG,SACvC,CAAC;AACH;AACF;EAEA,IAAIC,KAAKA,GAA0B;IACjC,MAAM;AAAEA,MAAAA,KAAK,GAAG;KAAO,GAAG,IAAI,CAAChB,IAAI;AACnC,IAAA,OAAOgB,KAAK;AACd;EAEA,IAAIC,IAAIA,GAAW;IACjB,IAAI,IAAI,CAACD,KAAK,KAAK,KAAK,EAAE,OAAO,cAAc,CAAC,KAC3C,OAAO,WAAW;AACzB;EAEA,IAAIE,KAAKA,GAAwC;IAC/C,MAAM;AAAEA,MAAAA,KAAK,GAAGvB;KAAe,GAAG,IAAI,CAACK,IAAI;AAE3Cc,IAAAA,MAAM,CACJ,CAA6DvB,0DAAAA,EAAAA,UAAU,CAAC4B,IAAI,CAC1E,IACF,CAAC,CAAA,YAAA,EAAeD,KAAK,CAAA,CAAE,EACvB3B,UAAU,CAAC6B,QAAQ,CAACF,KAAK,CAC3B,CAAC;AAED,IAAA,OAAOA,KAAK;AACd;;AAEA;EACA,IAAIP,OAAOA,GAAW;AACpB,IAAA,IAAI,IAAI,CAACX,IAAI,CAACW,OAAO,EAAE;AACrB,MAAA,OAAO,QAAQ,IAAI,CAACX,IAAI,CAACW,OAAO,CAAE,CAAA;AACpC;AACA,IAAA,OAAO,MAAM;AACf;EAEA,IAAIC,OAAOA,GAAuB;AAChC,IAAA,IAAI,IAAI,CAACZ,IAAI,CAACY,OAAO,EAAE;AACrB,MAAA,OAAO,QAAQ,IAAI,CAACZ,IAAI,CAACY,OAAO,CAAE,CAAA;AACpC;AACA,IAAA,OAAO,MAAM;AACf;EAEA,IAAIS,WAAWA,GAAuB;AACpC,IAAA,IAAI,IAAI,CAACrB,IAAI,CAACsB,KAAK,EAAE;AACnB,MAAA,OAAO,QAAQ,IAAI,CAACtB,IAAI,CAACsB,KAAK,CAAiB,eAAA,CAAA;AACjD;AACF;EAEA,IAAIC,UAAUA,GAAW;AACvB,IAAA,MAAMC,OAAO,GAAG,CAAC,wBAAwB,CAAC;;AAE1C;IACA,IAAI,IAAI,CAACN,KAAK,EAAE;MACdM,OAAO,CAACC,IAAI,CAAC,CAAA,8BAAA,EAAiC,IAAI,CAACP,KAAK,EAAE,CAAC;AAC7D;AAEA,IAAA,IAAI,IAAI,CAAClB,IAAI,CAACa,cAAc,EAAE;AAC5BW,MAAAA,OAAO,CAACC,IAAI,CAAC,0CAA0C,CAAC;AAC1D;IAEA,IAAI,IAAI,CAACzB,IAAI,CAACa,cAAc,IAAI,IAAI,CAACb,IAAI,CAAC0B,oBAAoB,EAAE;AAC9DF,MAAAA,OAAO,CAACC,IAAI,CAAC,iDAAiD,CAAC;AACjE;AAEA,IAAA,OAAOD,OAAO,CAACL,IAAI,CAAC,GAAG,CAAC;AAC1B;EAEA,IAAIQ,eAAeA,GAAY;IAC7B,MAAM;AAAEC,MAAAA;KAAqB,GAAG,IAAI,CAAC5B,IAAI;IAEzC,OAAO4B,mBAAmB,IAAI,KAAK;AACrC;AAEQC,EAAAA,qBAAqBA,GAAS;IACpC,IAAI,CAACC,gBAAgB,GAAG,KAAK;AAC7BD,IAAAA,qBAAqB,CAAC,IAAI,CAAC1B,QAAQ,CAAC;AACtC;AAAC,EAAA;IAAA4B,CAAA,CAAA,IAAA,CAAA1B,SAAA,EAAA,uBAAA,EAAA,CAHA2B,MAAM,CAAA,CAAA;AAAA;AAKCC,EAAAA,eAAeA,GAAS;IAC9B,IAAI,CAACH,gBAAgB,GAAG,IAAI;AAC9B;AAAC,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAA1B,SAAA,EAAA,iBAAA,EAAA,CAFA2B,MAAM,CAAA,CAAA;AAAA;AAICE,EAAAA,eAAeA,GAAiC;AACtD,IAAA,MAAMC,qBAAqB,GAAGC,SAAS,CAAC,IAAI,CAACjC,QAAQ,CAAC;IACtD,OAAOgC,qBAAqB,CAAC,CAAC,CAAC;AACjC;AAAC,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAA1B,SAAA,EAAA,iBAAA,EAAA,CAHA2B,MAAM,CAAA,CAAA;AAAA;EAKCK,UAAUA,CAACC,OAAuB,EAAQ;IAChD,IAAI,CAACnC,QAAQ,GAAGmC,OAAO;AACzB;AAAC,EAAA;IAAAP,CAAA,CAAA,IAAA,CAAA1B,SAAA,EAAA,YAAA,EAAA,CAFA2B,MAAM,CAAA,CAAA;AAAA;AAICO,EAAAA,4BAA4B,GAAGC,QAAQ,CAC5CF,OAA2D,IAAK;IAC/D,IAAI,CAACG,oBAAoB,GAAGH,OAAO;AACrC,GACF,CAAC;AAEOI,EAAAA,mBAAmB,GAAGF,QAAQ,CAAEG,MAAyB,IAAK;IACpE,MAAM;MAAEC,qBAAqB;AAAEC,MAAAA;KAAyB,GAAG,IAAI,CAAC7C,IAAI;AACpE,IAAA,IAAI,OAAO4C,qBAAqB,KAAK,UAAU,EAAE;MAC/CA,qBAAqB,CAACD,MAAM,CAAC;AAC/B;AAEA,IAAA,OAAO,MAAM;AACX,MAAA,IAAI,OAAOE,uBAAuB,KAAK,UAAU,EAAE;QACjDA,uBAAuB,CAACF,MAAM,CAAC;AACjC;KACD;AACH,GAAC,CAAC;AACJ;AAACG,oBAAA,CAAAC,QAAA,EA9HoBlD,kBAAkB,CAAA;;;;"}