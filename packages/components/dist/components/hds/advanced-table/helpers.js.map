{"version":3,"file":"helpers.js","sources":["../../../../src/components/hds/advanced-table/helpers.ts"],"sourcesContent":["// TODO\n// did insert\n// add escape listener to focusable elements inside cell\n\nimport type { HdsAdvancedTableTdSignature } from './td';\nimport type { HdsAdvancedTableThSignature } from './th';\n\nconst getAllFocusableChildren = (element: HTMLElement): NodeListOf<Element> => {\n  return element.querySelectorAll(\n    'button, a[href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n  );\n};\n\nconst handleGridCellChildKeyPress = (event: KeyboardEvent): void => {\n  const { key, target } = event;\n\n  console.log('key', key);\n  console.log('target', target);\n\n  if (target instanceof HTMLElement) {\n    if (key === 'Escape') {\n      const cell = target.closest(\n        'hds-advanced-table__th, hds-advanced-table__td'\n      );\n\n      console.log(cell);\n\n      if (cell instanceof HTMLElement) {\n        cell.setAttribute('tabindex', '0');\n        cell.focus();\n      }\n    }\n  }\n};\n\nexport const didInsertGridCell = (\n  cell:\n    | HdsAdvancedTableThSignature['Element']\n    | HdsAdvancedTableTdSignature['Element']\n): void => {\n  const focusableChildren = getAllFocusableChildren(cell);\n\n  for (const child of focusableChildren) {\n    if (child instanceof HTMLElement) {\n      child.setAttribute('tabindex', '-1');\n      child.addEventListener('keydown', handleGridCellChildKeyPress);\n    }\n  }\n\n  const currentRow = cell.parentElement;\n\n  if (\n    currentRow?.parentElement?.classList.contains('hds-advanced-table__thead')\n  ) {\n    const thead = currentRow.parentElement;\n    if (\n      thead.children.item(0) === currentRow &&\n      currentRow.children.item(0) === cell\n    ) {\n      cell.setAttribute('tabindex', '0');\n    } else {\n      cell.setAttribute('tabindex', '-1');\n    }\n  } else if (\n    currentRow?.parentElement?.classList.contains('hds-advanced-table__tbody')\n  ) {\n    const table = currentRow.parentElement?.closest('[role=\"grid\"]');\n    const thead = table?.querySelector(\n      '[role=\"rowgroup\"].hds-advanced-table__thead'\n    );\n    const tbody = table?.querySelector(\n      '[role=\"rowgroup\"].hds-advanced-table__tbody'\n    );\n\n    if (thead === null) {\n      if (\n        tbody?.children.item(0) === currentRow &&\n        currentRow.children.item(0) === cell\n      ) {\n        cell.setAttribute('tabindex', '0');\n      }\n    } else {\n      cell.setAttribute('tabindex', '-1');\n    }\n  }\n};\n\nexport const handleGridCellKeyPress = (event: KeyboardEvent): void => {\n  const { key, target } = event;\n\n  const changeActiveCell = (oldCell: HTMLElement, newCell: HTMLElement) => {\n    oldCell.setAttribute('tabindex', '-1');\n    newCell.setAttribute('tabindex', '0');\n    newCell.focus();\n  };\n\n  const findNewRow = (\n    currentRow: HTMLElement,\n    direction: 'ArrowDown' | 'ArrowUp'\n  ) => {\n    const table = currentRow.parentElement?.closest('[role=\"grid\"]');\n    const allRows = table?.querySelectorAll('[role=\"row\"]');\n\n    if (allRows) {\n      const currentRowIndex = Array.from(allRows).indexOf(currentRow);\n      if (direction === 'ArrowDown') return allRows[currentRowIndex + 1];\n      else if (direction === 'ArrowUp') return allRows[currentRowIndex - 1];\n    }\n  };\n\n  if (target instanceof HTMLElement) {\n    if (key === 'Enter') {\n      const focusableChildren = getAllFocusableChildren(target);\n\n      // TODO: test this more. if screen reader keeps up with the state of the focusable element, can bring it back.\n      // if (focusableChildren.length === 1) {\n      //   const element = focusableChildren[0] as HTMLElement;\n      //   element.click();\n      // } else\n\n      if (focusableChildren.length > 0) {\n        const element = focusableChildren[0] as HTMLElement;\n        element.focus();\n      }\n    } else if (event.key === 'ArrowRight' || event.key === 'ArrowLeft') {\n      const nextElement =\n        key === 'ArrowRight'\n          ? target.nextElementSibling\n          : target.previousElementSibling;\n\n      if (nextElement !== null && nextElement instanceof HTMLElement) {\n        changeActiveCell(target, nextElement);\n      }\n    } else if (event.key === 'ArrowDown' || event.key === 'ArrowUp') {\n      const currentRow = target.parentElement;\n\n      if (currentRow instanceof HTMLElement) {\n        const currentCellIndex = Array.from(currentRow.children).indexOf(\n          target\n        );\n        const nextRow = findNewRow(currentRow, event.key);\n\n        if (nextRow !== null && nextRow instanceof HTMLElement) {\n          const nextCell = nextRow.children[currentCellIndex];\n          if (nextCell instanceof HTMLElement) {\n            changeActiveCell(target, nextCell);\n          }\n        }\n      }\n    } else if (event.key === 'Home' || event.key === 'End') {\n      event.preventDefault();\n      if (event.ctrlKey) {\n        const table = target.parentElement?.closest('[role=\"grid\"]');\n        const allRows = table?.querySelectorAll('[role=\"row\"]');\n\n        if (allRows) {\n          const nextRow =\n            key === 'Home' ? allRows[0] : allRows[allRows.length - 1];\n\n          if (nextRow) {\n            const cellsInNextRow = nextRow.children;\n            const nextElement =\n              key === 'Home'\n                ? cellsInNextRow[0]\n                : cellsInNextRow[cellsInNextRow.length - 1];\n\n            if (nextElement && nextElement instanceof HTMLElement) {\n              changeActiveCell(target, nextElement);\n            }\n          }\n        }\n      } else {\n        const currentRow = target.parentElement;\n\n        if (currentRow) {\n          const allCells = currentRow.children;\n          const nextElement =\n            key === 'Home' ? allCells[0] : allCells[allCells.length - 1];\n\n          if (nextElement && nextElement instanceof HTMLElement) {\n            changeActiveCell(target, nextElement);\n          }\n        }\n      }\n    } else if (event.key === 'PageUp' || event.key === 'PageDown') {\n      event.preventDefault();\n      const currentRow = target.parentElement;\n\n      if (currentRow instanceof HTMLElement) {\n        const currentCellIndex = Array.from(currentRow.children).indexOf(\n          target\n        );\n\n        const table = currentRow.parentElement?.closest('[role=\"grid\"]');\n        const allRows = table?.querySelectorAll('[role=\"row\"]');\n\n        if (allRows) {\n          const nextRow =\n            event.key === 'PageUp' ? allRows[0] : allRows[allRows.length - 1];\n\n          if (nextRow !== null && nextRow instanceof HTMLElement) {\n            const nextCell = nextRow.children[currentCellIndex];\n            if (nextCell instanceof HTMLElement) {\n              changeActiveCell(target, nextCell);\n            }\n          }\n        }\n      }\n    }\n  }\n};\n"],"names":["getAllFocusableChildren","element","querySelectorAll","handleGridCellChildKeyPress","event","key","target","console","log","HTMLElement","cell","closest","setAttribute","focus","didInsertGridCell","focusableChildren","child","addEventListener","currentRow","parentElement","classList","contains","thead","children","item","table","querySelector","tbody","handleGridCellKeyPress","changeActiveCell","oldCell","newCell","findNewRow","direction","allRows","currentRowIndex","Array","from","indexOf","length","nextElement","nextElementSibling","previousElementSibling","currentCellIndex","nextRow","nextCell","preventDefault","ctrlKey","cellsInNextRow","allCells"],"mappings":"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"}