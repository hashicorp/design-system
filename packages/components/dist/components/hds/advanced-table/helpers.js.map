{"version":3,"file":"helpers.js","sources":["../../../../src/components/hds/advanced-table/helpers.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport { focusable, tabbable } from 'tabbable';\n\nimport type { HdsAdvancedTableTdSignature } from './td.ts';\nimport type { HdsAdvancedTableThSignature } from './th.ts';\n\nexport const onFocusTrapDeactivate = (cell: HTMLDivElement) => {\n  const cellTabbableChildren = tabbable(cell);\n\n  for (const child of cellTabbableChildren) {\n    child.setAttribute('tabindex', '-1');\n  }\n\n  cell.setAttribute('tabindex', '0');\n};\n\nexport const updateTabbableChildren = (\n  cell: HTMLDivElement,\n  isFocusTrapActive?: boolean\n): void => {\n  const cellTabbableChildren = tabbable(cell);\n\n  for (const child of cellTabbableChildren) {\n    if (child instanceof HTMLElement) {\n      if (!isFocusTrapActive) {\n        child.setAttribute('tabindex', '-1');\n      }\n      child.setAttribute('data-advanced-table-child-focusable', '');\n    }\n  }\n};\n\nexport const didInsertGridCell = (\n  cell:\n    | HdsAdvancedTableThSignature['Element']\n    | HdsAdvancedTableTdSignature['Element']\n): void => {\n  updateTabbableChildren(cell);\n\n  const currentRow = cell.parentElement;\n\n  if (\n    currentRow?.parentElement?.classList.contains('hds-advanced-table__thead')\n  ) {\n    const thead = currentRow.parentElement;\n    if (\n      thead.children.item(0) === currentRow &&\n      currentRow.children.item(0) === cell\n    ) {\n      cell.setAttribute('tabindex', '0');\n    } else {\n      cell.setAttribute('tabindex', '-1');\n    }\n  } else if (\n    currentRow?.parentElement?.classList.contains('hds-advanced-table__tbody')\n  ) {\n    const grid = currentRow.parentElement?.closest('[role=\"grid\"]');\n    const thead = grid?.querySelector(\n      '[role=\"rowgroup\"].hds-advanced-table__thead'\n    );\n    const tbody = grid?.querySelector(\n      '[role=\"rowgroup\"].hds-advanced-table__tbody'\n    );\n\n    if (thead === null) {\n      if (\n        tbody?.children.item(0) === currentRow &&\n        currentRow.children.item(0) === cell\n      ) {\n        cell.setAttribute('tabindex', '0');\n      }\n    } else {\n      cell.setAttribute('tabindex', '-1');\n    }\n  }\n};\n\nexport const handleGridCellKeyPress = (\n  event: KeyboardEvent,\n  enableFocusTrap: () => void\n): void => {\n  const { key, target } = event;\n\n  const changeActiveCell = (oldCell: HTMLElement, newCell: HTMLElement) => {\n    oldCell.setAttribute('tabindex', '-1');\n    newCell.setAttribute('tabindex', '0');\n    newCell.focus();\n  };\n\n  const findNewRow = (\n    currentRow: HTMLElement,\n    direction: 'ArrowDown' | 'ArrowUp'\n  ) => {\n    const grid = currentRow.parentElement?.closest('[role=\"grid\"]');\n    const allRows = grid?.querySelectorAll('[role=\"row\"]');\n\n    if (allRows) {\n      const currentRowIndex = Array.from(allRows).indexOf(currentRow);\n      if (direction === 'ArrowDown') return allRows[currentRowIndex + 1];\n      else if (direction === 'ArrowUp') return allRows[currentRowIndex - 1];\n    }\n  };\n\n  if (\n    target instanceof HTMLElement &&\n    (target.classList.contains('hds-advanced-table__th') ||\n      target.classList.contains('hds-advanced-table__td'))\n  ) {\n    if (key === 'Enter') {\n      const cellFocusableChildren = focusable(target);\n\n      if (cellFocusableChildren.length > 0) {\n        for (let i = 0; i < cellFocusableChildren.length; i++) {\n          const child = cellFocusableChildren[i];\n          if (child?.hasAttribute('data-advanced-table-child-focusable')) {\n            child.setAttribute('tabindex', '0');\n          }\n        }\n        target.setAttribute('tabindex', '-1');\n        enableFocusTrap();\n      }\n    } else if (event.key === 'ArrowRight' || event.key === 'ArrowLeft') {\n      const nextElement =\n        key === 'ArrowRight'\n          ? target.nextElementSibling\n          : target.previousElementSibling;\n\n      if (nextElement !== null && nextElement instanceof HTMLElement) {\n        changeActiveCell(target, nextElement);\n      }\n    } else if (event.key === 'ArrowDown' || event.key === 'ArrowUp') {\n      const currentRow = target.parentElement;\n\n      if (currentRow instanceof HTMLElement) {\n        const currentCellIndex = Array.from(currentRow.children).indexOf(\n          target\n        );\n        const nextRow = findNewRow(currentRow, event.key);\n\n        if (nextRow !== null && nextRow instanceof HTMLElement) {\n          const nextCell = nextRow.children[currentCellIndex];\n          if (nextCell instanceof HTMLElement) {\n            changeActiveCell(target, nextCell);\n          }\n        }\n      }\n    } else if (event.key === 'Home' || event.key === 'End') {\n      event.preventDefault();\n      if (event.ctrlKey) {\n        const table = target.parentElement?.closest('[role=\"grid\"]');\n        const allRows = table?.querySelectorAll('[role=\"row\"]');\n\n        if (allRows) {\n          const nextRow =\n            key === 'Home' ? allRows[0] : allRows[allRows.length - 1];\n\n          if (nextRow) {\n            const cellsInNextRow = nextRow.children;\n            const nextElement =\n              key === 'Home'\n                ? cellsInNextRow[0]\n                : cellsInNextRow[cellsInNextRow.length - 1];\n\n            if (nextElement && nextElement instanceof HTMLElement) {\n              changeActiveCell(target, nextElement);\n            }\n          }\n        }\n      } else {\n        const currentRow = target.parentElement;\n\n        if (currentRow) {\n          const allCells = currentRow.children;\n          const nextElement =\n            key === 'Home' ? allCells[0] : allCells[allCells.length - 1];\n\n          if (nextElement && nextElement instanceof HTMLElement) {\n            changeActiveCell(target, nextElement);\n          }\n        }\n      }\n    } else if (event.key === 'PageUp' || event.key === 'PageDown') {\n      event.preventDefault();\n      const currentRow = target.parentElement;\n\n      if (currentRow instanceof HTMLElement) {\n        const currentCellIndex = Array.from(currentRow.children).indexOf(\n          target\n        );\n\n        const grid = currentRow.parentElement?.closest('[role=\"grid\"]');\n        const allRows = grid?.querySelectorAll('[role=\"row\"]');\n\n        if (allRows) {\n          const nextRow =\n            event.key === 'PageUp' ? allRows[0] : allRows[allRows.length - 1];\n\n          if (nextRow !== null && nextRow instanceof HTMLElement) {\n            const nextCell = nextRow.children[currentCellIndex];\n            if (nextCell instanceof HTMLElement) {\n              changeActiveCell(target, nextCell);\n            }\n          }\n        }\n      }\n    }\n  }\n};\n"],"names":["onFocusTrapDeactivate","cell","cellTabbableChildren","tabbable","child","setAttribute","updateTabbableChildren","isFocusTrapActive","HTMLElement","didInsertGridCell","currentRow","parentElement","classList","contains","thead","children","item","grid","closest","querySelector","tbody","handleGridCellKeyPress","event","enableFocusTrap","key","target","changeActiveCell","oldCell","newCell","focus","findNewRow","direction","allRows","querySelectorAll","currentRowIndex","Array","from","indexOf","cellFocusableChildren","focusable","length","i","hasAttribute","nextElement","nextElementSibling","previousElementSibling","currentCellIndex","nextRow","nextCell","preventDefault","ctrlKey","table","cellsInNextRow","allCells"],"mappings":"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"}