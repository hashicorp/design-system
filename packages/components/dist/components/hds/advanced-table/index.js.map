{"version":3,"file":"index.js","sources":["../../../../src/components/hds/advanced-table/index.hbs","../../../../src/components/hds/advanced-table/index.ts"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{!\\n  Copyright (c) HashiCorp, Inc.\\n  SPDX-License-Identifier: MPL-2.0\\n}}\\n\\n<div\\n  class={{this.classNames}}\\n  ...attributes\\n  role=\\\"grid\\\"\\n  aria-describedby={{this._captionId}}\\n  {{style grid-template-columns=this.gridTemplateColumns}}\\n  {{did-insert this.didInsert}}\\n  {{will-destroy this.willDestroy}}\\n>\\n  <div id={{this._captionId}} class=\\\"sr-only hds-advanced-table__caption\\\" aria-live=\\\"polite\\\">\\n    {{@caption}}\\n    {{this.sortedMessageText}}\\n  </div>\\n  <div class=\\\"hds-advanced-table__thead {{if @hasStickyHeader \\'hds-advanced-table__thead--sticky\\'}}\\\" role=\\\"rowgroup\\\">\\n    <Hds::AdvancedTable::Tr\\n      @selectionScope=\\\"col\\\"\\n      @onClickSortBySelected={{if @selectableColumnKey (fn this.setSortBy @selectableColumnKey)}}\\n      @sortBySelectedOrder={{if (eq this._sortBy @selectableColumnKey) this._sortOrder}}\\n      @isSelectable={{this.isSelectable}}\\n      @onSelectionChange={{this.onSelectionAllChange}}\\n      @didInsert={{this.didInsertSelectAllCheckbox}}\\n      @willDestroy={{this.willDestroySelectAllCheckbox}}\\n      @selectionAriaLabelSuffix=\\\"all rows\\\"\\n    >\\n      {{#each @columns as |column|}}\\n        {{#if column.isSortable}}\\n          <Hds::AdvancedTable::ThSort\\n            @sortOrder={{if (eq column.key this._sortBy) this._sortOrder}}\\n            @onClickSort={{fn this.setSortBy column.key}}\\n            @align={{column.align}}\\n            @tooltip={{column.tooltip}}\\n          >\\n            {{column.label}}\\n          </Hds::AdvancedTable::ThSort>\\n        {{else}}\\n          <Hds::AdvancedTable::Th\\n            @align={{column.align}}\\n            @tooltip={{column.tooltip}}\\n            @isVisuallyHidden={{column.isVisuallyHidden}}\\n          >{{column.label}}</Hds::AdvancedTable::Th>\\n        {{/if}}\\n      {{/each}}\\n    </Hds::AdvancedTable::Tr>\\n  </div>\\n\\n  <div class=\\\"hds-advanced-table__tbody\\\" role=\\\"rowgroup\\\">\\n    {{! ----------------------------------------------------------------------------------------\\n        IMPORTANT: we loop on the `model` array and for each record\\n        we yield the Tr/Td/Th elements _and_ the record itself as `data`\\n        this means the consumer will *have to* use the `data` key to access it in their template\\n      -------------------------------------------------------------------------------------------- }}\\n    {{#each (sort-by this.getSortCriteria @model) key=this.identityKey as |record index|}}\\n      {{#if this.hasNestedRows}}\\n        <Hds::AdvancedTable::ExpandableTrGroup\\n          @record={{record}}\\n          @childrenKey={{this.childrenKey}}\\n          @rowIndex={{index}}\\n          as |T|\\n        >\\n          {{yield\\n            (hash\\n              Tr=(component \\\"hds/advanced-table/tr\\\" isParentRow=T.isExpandable depth=T.depth)\\n              Th=(component\\n                \\\"hds/advanced-table/th\\\"\\n                scope=\\\"row\\\"\\n                isExpandable=T.isExpandable\\n                newLabel=T.id\\n                parentId=T.parentId\\n                onClickToggle=T.onClickToggle\\n                isExpanded=T.isExpanded\\n                depth=T.depth\\n              )\\n              Td=(component \\\"hds/advanced-table/td\\\" align=@align)\\n              data=T.data\\n              isOpen=T.isExpanded\\n              rowIndex=T.rowIndex\\n            )\\n            to=\\\"body\\\"\\n          }}\\n        </Hds::AdvancedTable::ExpandableTrGroup>\\n      {{else}}\\n        {{yield\\n          (hash\\n            Tr=(component\\n              \\\"hds/advanced-table/tr\\\"\\n              selectionScope=\\\"row\\\"\\n              isSelectable=this.isSelectable\\n              onSelectionChange=this.onSelectionRowChange\\n              didInsert=this.didInsertRowCheckbox\\n              willDestroy=this.willDestroyRowCheckbox\\n              selectionAriaLabelSuffix=@selectionAriaLabelSuffix\\n            )\\n            Th=(component \\\"hds/advanced-table/th\\\" scope=\\\"row\\\")\\n            Td=(component \\\"hds/advanced-table/td\\\" align=@align)\\n            data=record\\n            rowIndex=index\\n          )\\n          to=\\\"body\\\"\\n        }}\\n      {{/if}}\\n    {{/each}}\\n  </div>\\n</div>\")","/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport Component from '@glimmer/component';\nimport { action } from '@ember/object';\nimport { assert } from '@ember/debug';\nimport { tracked } from '@glimmer/tracking';\nimport type { ComponentLike } from '@glint/template';\nimport { guidFor } from '@ember/object/internals';\nimport config from 'ember-get-config';\n\nimport {\n  HdsAdvancedTableDensityValues,\n  HdsAdvancedTableThSortOrderValues,\n  HdsAdvancedTableVerticalAlignmentValues,\n} from './types.ts';\nimport type {\n  HdsAdvancedTableColumn,\n  HdsAdvancedTableDensities,\n  HdsAdvancedTableHorizontalAlignment,\n  HdsAdvancedTableOnSelectionChangeSignature,\n  HdsAdvancedTableSelectableRow,\n  HdsAdvancedTableSortingFunction,\n  HdsAdvancedTableThSortOrder,\n  HdsAdvancedTableVerticalAlignment,\n  HdsAdvancedTableModel,\n} from './types.ts';\nimport type { HdsFormCheckboxBaseSignature } from '../form/checkbox/base.ts';\nimport type { HdsAdvancedTableTdSignature } from './td.ts';\nimport type { HdsAdvancedTableThSignature } from './th.ts';\nimport type { HdsAdvancedTableTrSignature } from './tr.ts';\n\nexport const DENSITIES: HdsAdvancedTableDensities[] = Object.values(\n  HdsAdvancedTableDensityValues\n);\nexport const DEFAULT_DENSITY = HdsAdvancedTableDensityValues.Medium;\n\nexport const VALIGNMENTS: HdsAdvancedTableVerticalAlignment[] = Object.values(\n  HdsAdvancedTableVerticalAlignmentValues\n);\nexport const DEFAULT_VALIGN = HdsAdvancedTableVerticalAlignmentValues.Top;\n\nexport interface HdsAdvancedTableSignature {\n  Args: {\n    align?: HdsAdvancedTableHorizontalAlignment;\n    caption?: string;\n    columns: HdsAdvancedTableColumn[];\n    density?: HdsAdvancedTableDensities;\n    identityKey?: string;\n    isSelectable?: boolean;\n    isStriped?: boolean;\n    model: HdsAdvancedTableModel;\n    onSelectionChange?: (\n      selection: HdsAdvancedTableOnSelectionChangeSignature\n    ) => void;\n    onSort?: (sortBy: string, sortOrder: HdsAdvancedTableThSortOrder) => void;\n    selectionAriaLabelSuffix?: string;\n    sortBy?: string;\n    selectableColumnKey?: string;\n    sortedMessageText?: string;\n    sortOrder?: HdsAdvancedTableThSortOrder;\n    valign?: HdsAdvancedTableVerticalAlignment;\n    hasStickyHeader?: boolean;\n    childrenKey?: string;\n  };\n  Blocks: {\n    body?: [\n      {\n        Td?: ComponentLike<HdsAdvancedTableTdSignature>;\n        Tr?: ComponentLike<HdsAdvancedTableTrSignature>;\n        Th?: ComponentLike<HdsAdvancedTableThSignature>;\n        data?: Record<string, unknown>;\n        rowIndex?: number | string;\n        isOpen?: boolean;\n      },\n    ];\n  };\n  Element: HTMLDivElement;\n}\n\nexport default class HdsAdvancedTable extends Component<HdsAdvancedTableSignature> {\n  @tracked private _sortBy = this.args.sortBy ?? undefined;\n  @tracked private _sortOrder =\n    this.args.sortOrder || HdsAdvancedTableThSortOrderValues.Asc;\n  @tracked\n  private _selectAllCheckbox?: HdsFormCheckboxBaseSignature['Element'] =\n    undefined;\n  @tracked private _isSelectAllCheckboxSelected?: boolean = undefined;\n\n  private _selectableRows: HdsAdvancedTableSelectableRow[] = [];\n  private _captionId = 'caption-' + guidFor(this);\n  private _observer: IntersectionObserver | undefined = undefined;\n\n  get getSortCriteria(): string | HdsAdvancedTableSortingFunction<unknown> {\n    // get the current column\n    const currentColumn = this.args?.columns?.find(\n      (column) => column.key === this._sortBy\n    );\n    if (\n      // check if there is a custom sorting function associated with the current `sortBy` column (we assume the column has `isSortable`)\n      currentColumn?.sortingFunction &&\n      typeof currentColumn.sortingFunction === 'function'\n    ) {\n      return currentColumn.sortingFunction;\n    } else {\n      // otherwise fallback to the default format \"sortBy:sortOrder\"\n      return `${this._sortBy}:${this._sortOrder}`;\n    }\n  }\n\n  get columnWidths(): string[] | undefined {\n    const { columns } = this.args;\n    const widths: string[] = new Array(columns.length);\n    let hasCustomColumnWidth = false;\n\n    for (let i = 0; i < columns.length; i++) {\n      const column = columns[i];\n\n      if (column?.['width']) {\n        widths[i] = column.width;\n        if (!hasCustomColumnWidth) hasCustomColumnWidth = true;\n      }\n    }\n\n    return hasCustomColumnWidth ? widths : undefined;\n  }\n\n  get identityKey(): string | undefined {\n    // we have to provide a way for the consumer to pass undefined because Ember tries to interpret undefined as missing an arg and therefore falls back to the default\n    if (this.args.identityKey === 'none') {\n      return undefined;\n    } else {\n      return this.args.identityKey ?? '@identity';\n    }\n  }\n\n  get childrenKey(): string {\n    const { childrenKey = 'children' } = this.args;\n\n    return childrenKey;\n  }\n\n  get hasNestedRows(): boolean {\n    const { model, columns } = this.args;\n    let hasNestedRows = false;\n    let isSortable = false;\n    const sortableColumns: string[] = [];\n\n    // if the model is not an array, assume there are no nested rows\n    if (!Array.isArray(model)) return false;\n\n    for (const column of columns) {\n      if (column.isSortable) {\n        isSortable = true;\n        sortableColumns.push(column.label);\n      }\n    }\n\n    for (const obj of model) {\n      if (this.childrenKey in obj) {\n        hasNestedRows = true;\n        break;\n      }\n    }\n\n    if (hasNestedRows) {\n      assert(\n        `Cannot have sortable columns if there are nested rows. Sortable columns are ${sortableColumns.toString()}`,\n        !isSortable\n      );\n    }\n\n    return hasNestedRows;\n  }\n\n  get sortedMessageText(): string {\n    if (this.args.sortedMessageText) {\n      return this.args.sortedMessageText;\n    } else if (this._sortBy && this._sortOrder) {\n      // we should allow the user to define a custom value here (e.g., for i18n) - tracked with HDS-965\n      return `Sorted by ${this._sortBy} ${this._sortOrder}ending`;\n    } else {\n      return '';\n    }\n  }\n\n  get isSelectable(): boolean {\n    const { isSelectable = false } = this.args;\n\n    if (this.hasNestedRows) {\n      assert(\n        '@isSelectable must not be true if there are nested rows.',\n        !isSelectable\n      );\n      return isSelectable;\n    }\n\n    return isSelectable;\n  }\n\n  get isStriped(): boolean {\n    const { isStriped = false } = this.args;\n\n    if (this.hasNestedRows) {\n      assert(\n        '@isStriped must not be true if there are nested rows.',\n        !isStriped\n      );\n      return isStriped;\n    }\n\n    return isStriped;\n  }\n\n  get density(): HdsAdvancedTableDensities {\n    const { density = DEFAULT_DENSITY } = this.args;\n\n    assert(\n      `@density for \"Hds::Table\" must be one of the following: ${DENSITIES.join(\n        ', '\n      )}; received: ${density}`,\n      DENSITIES.includes(density)\n    );\n\n    return density;\n  }\n\n  get valign(): HdsAdvancedTableVerticalAlignment {\n    const { valign = DEFAULT_VALIGN } = this.args;\n\n    assert(\n      `@valign for \"Hds::Table\" must be one of the following: ${VALIGNMENTS.join(\n        ', '\n      )}; received: ${valign}`,\n      VALIGNMENTS.includes(valign)\n    );\n\n    return valign;\n  }\n\n  // returns the grid-template-columns CSS attribute for the grid\n  get gridTemplateColumns(): string {\n    const { isSelectable, columns } = this.args;\n\n    // if there is no custom column widths, each column is the same width and they take up the available space (except the select checkbox)\n    if (!this.columnWidths) {\n      return `${isSelectable ? 'auto ' : ''}repeat(${columns.length}, 1fr)`;\n    }\n\n    // if there is a select checkbox, the first column is 'auto' width to hug the checkbox content\n    let style = isSelectable ? 'auto' : '';\n\n    // check the custom column widths, if the current column has a custom width use the custom width. otherwise take the available space.\n    for (let i = 0; i < this.columnWidths.length; i++) {\n      style += ` ${this.columnWidths[i] ? this.columnWidths[i] : '1fr'}`;\n    }\n\n    return style;\n  }\n\n  get classNames(): string {\n    const classes = ['hds-advanced-table'];\n\n    if (this.isStriped) {\n      classes.push('hds-advanced-table--striped');\n    }\n\n    if (this.density) {\n      classes.push(`hds-advanced-table--density-${this.density}`);\n    }\n\n    if (this.valign) {\n      classes.push(`hds-advanced-table--valign-${this.valign}`);\n    }\n\n    if (this.hasNestedRows) {\n      classes.push(`hds-advanced-table--nested`);\n    }\n\n    return classes.join(' ');\n  }\n\n  @action didInsert(element: HTMLDivElement): void {\n    const stickyGridHeader = element.querySelector(\n      '.hds-advanced-table__thead.hds-advanced-table__thead--sticky'\n    );\n\n    if (stickyGridHeader !== null && config.environment !== 'test') {\n      this._observer = new IntersectionObserver(\n        ([element]) =>\n          element?.target.classList.toggle(\n            'hds-advanced-table__thead--is-pinned',\n            element.intersectionRatio < 1\n          ),\n        { threshold: [1] }\n      );\n\n      this._observer.observe(stickyGridHeader);\n    }\n  }\n\n  @action willDestroy() {\n    super.willDestroy();\n    if (this._observer) {\n      this._observer.disconnect();\n    }\n  }\n\n  @action\n  setSortBy(column: string): void {\n    if (this._sortBy === column) {\n      // check to see if the column is already sorted and invert the sort order if so\n      this._sortOrder =\n        this._sortOrder === HdsAdvancedTableThSortOrderValues.Asc\n          ? HdsAdvancedTableThSortOrderValues.Desc\n          : HdsAdvancedTableThSortOrderValues.Asc;\n    } else {\n      // otherwise, set the sort order to ascending\n      this._sortBy = column;\n      this._sortOrder = HdsAdvancedTableThSortOrderValues.Asc;\n    }\n\n    const { onSort } = this.args;\n\n    if (typeof onSort === 'function') {\n      onSort(this._sortBy, this._sortOrder);\n    }\n  }\n\n  onSelectionChangeCallback(\n    checkbox?: HdsFormCheckboxBaseSignature['Element'],\n    selectionKey?: string\n  ): void {\n    const { onSelectionChange } = this.args;\n\n    if (typeof onSelectionChange !== 'function') return;\n\n    onSelectionChange({\n      selectionKey: selectionKey,\n      selectionCheckboxElement: checkbox,\n      selectedRowsKeys: this._selectableRows.reduce<string[]>((acc, row) => {\n        if (row.checkbox.checked) {\n          acc.push(row.selectionKey);\n        }\n        return acc;\n      }, []),\n      selectableRowsStates: this._selectableRows.reduce(\n        (\n          acc: { selectionKey: string; isSelected: boolean | undefined }[],\n          row\n        ) => {\n          acc.push({\n            selectionKey: row.selectionKey,\n            isSelected: row.checkbox.checked,\n          });\n          return acc;\n        },\n        []\n      ),\n    });\n  }\n\n  @action\n  onSelectionAllChange(): void {\n    this._selectableRows.forEach((row) => {\n      row.checkbox.checked = this._selectAllCheckbox?.checked ?? false;\n      row.checkbox.dispatchEvent(new Event('toggle', { bubbles: false }));\n    });\n    this._isSelectAllCheckboxSelected =\n      this._selectAllCheckbox?.checked ?? false;\n    this.onSelectionChangeCallback(this._selectAllCheckbox, 'all');\n  }\n\n  @action\n  onSelectionRowChange(\n    checkbox?: HdsFormCheckboxBaseSignature['Element'],\n    selectionKey?: string\n  ): void {\n    this.setSelectAllState();\n    this.onSelectionChangeCallback(checkbox, selectionKey);\n  }\n\n  @action\n  didInsertSelectAllCheckbox(\n    checkbox: HdsFormCheckboxBaseSignature['Element']\n  ): void {\n    this._selectAllCheckbox = checkbox;\n  }\n\n  @action\n  willDestroySelectAllCheckbox(): void {\n    this._selectAllCheckbox = undefined;\n  }\n\n  @action\n  didInsertRowCheckbox(\n    checkbox: HdsFormCheckboxBaseSignature['Element'],\n    selectionKey?: string\n  ): void {\n    if (selectionKey) {\n      this._selectableRows.push({ selectionKey, checkbox });\n    }\n    this.setSelectAllState();\n  }\n\n  @action\n  willDestroyRowCheckbox(selectionKey?: string): void {\n    this._selectableRows = this._selectableRows.filter(\n      (row) => row.selectionKey !== selectionKey\n    );\n    this.setSelectAllState();\n  }\n\n  @action\n  setSelectAllState(): void {\n    if (this._selectAllCheckbox) {\n      const selectableRowsCount = this._selectableRows.length;\n      const selectedRowsCount = this._selectableRows.filter(\n        (row) => row.checkbox.checked\n      ).length;\n\n      this._selectAllCheckbox.checked =\n        selectedRowsCount === selectableRowsCount;\n      this._selectAllCheckbox.indeterminate =\n        selectedRowsCount > 0 && selectedRowsCount < selectableRowsCount;\n      this._isSelectAllCheckboxSelected = this._selectAllCheckbox.checked;\n      this._selectAllCheckbox.dispatchEvent(\n        new Event('toggle', { bubbles: false })\n      );\n    }\n  }\n}\n"],"names":["DENSITIES","Object","values","HdsAdvancedTableDensityValues","DEFAULT_DENSITY","Medium","VALIGNMENTS","HdsAdvancedTableVerticalAlignmentValues","DEFAULT_VALIGN","Top","HdsAdvancedTable","_class","Component","constructor","args","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_defineProperty","guidFor","undefined","getSortCriteria","currentColumn","columns","find","column","key","_sortBy","sortingFunction","_sortOrder","columnWidths","widths","Array","length","hasCustomColumnWidth","i","width","identityKey","childrenKey","hasNestedRows","model","isSortable","sortableColumns","isArray","push","label","obj","assert","toString","sortedMessageText","isSelectable","isStriped","density","join","includes","valign","gridTemplateColumns","style","classNames","classes","didInsert","element","stickyGridHeader","querySelector","config","environment","_observer","IntersectionObserver","target","classList","toggle","intersectionRatio","threshold","observe","willDestroy","disconnect","setSortBy","HdsAdvancedTableThSortOrderValues","Asc","Desc","onSort","onSelectionChangeCallback","checkbox","selectionKey","onSelectionChange","selectionCheckboxElement","selectedRowsKeys","_selectableRows","reduce","acc","row","checked","selectableRowsStates","isSelected","onSelectionAllChange","forEach","_selectAllCheckbox","dispatchEvent","Event","bubbles","_isSelectAllCheckboxSelected","onSelectionRowChange","setSelectAllState","didInsertSelectAllCheckbox","willDestroySelectAllCheckbox","didInsertRowCheckbox","willDestroyRowCheckbox","filter","selectableRowsCount","selectedRowsCount","indeterminate","_applyDecoratedDescriptor","prototype","tracked","configurable","enumerable","writable","initializer","sortBy","sortOrder","action","getOwnPropertyDescriptor","setComponentTemplate","TEMPLATE"],"mappings":"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"}