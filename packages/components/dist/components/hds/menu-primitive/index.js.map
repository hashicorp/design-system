{"version":3,"file":"index.js","sources":["../../../../src/components/hds/menu-primitive/index.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport Component from '@glimmer/component';\nimport { deprecate } from '@ember/debug';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { schedule } from '@ember/runloop';\nimport type Owner from '@ember/owner';\n\nexport interface MenuPrimitiveSignature {\n  Args: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    onClose?: (...args: any[]) => void;\n  };\n  Blocks: {\n    toggle?: [\n      {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        onClickToggle: (event: MouseEvent, ...args: any[]) => void;\n        isOpen?: boolean;\n      },\n    ];\n    content?: [\n      {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        close: (...args: any[]) => void;\n      },\n    ];\n  };\n  Element: HTMLDivElement;\n}\n\nexport default class MenuPrimitive extends Component<MenuPrimitiveSignature> {\n  @tracked isOpen: boolean | undefined; // notice: if in the future we need to add a \"@isOpen\" prop to control the status from outside (eg to have the MenuPrimitive opened on render) just add  \"this.args.isOpen\" here to initalize the variable\n  @tracked toggleRef: HTMLElement | undefined;\n  @tracked _element!: HTMLElement;\n\n  constructor(owner: Owner, args: MenuPrimitiveSignature['Args']) {\n    super(owner, args);\n\n    deprecate(\n      'The `Hds::MenuPrimitive` component is now deprecated and will be removed in the next major version of `@hashicorp/design-system-components`.',\n      false,\n      {\n        id: 'hds.components.menu-primitive',\n        until: '5.0.0',\n        url: 'https://helios.hashicorp.design/components/menu-primitive?tab=version%20history#460',\n        for: '@hashicorp/design-system-components',\n        since: {\n          enabled: '4.10.0',\n          available: '4.10.0',\n        },\n      }\n    );\n  }\n\n  @action\n  didInsert(element: HTMLElement): void {\n    this._element = element;\n  }\n\n  @action\n  onClickToggle(event: MouseEvent): void {\n    // we store a reference to the DOM node that has the \"onClickToggle\" event associated with it\n    if (!this.toggleRef) {\n      this.toggleRef = event.currentTarget as HTMLElement;\n    }\n    this.isOpen = !this.isOpen;\n    // we explicitly apply a focus state to the toggle element to overcome a bug in WebKit (see https://github.com/hashicorp/design-system/commit/40cd7f6b3cb15c45f9a1235fafd0fb3ed58e6e62)\n    this.toggleRef?.focus();\n  }\n\n  @action\n  onFocusOut(event: FocusEvent): void {\n    // due to inconsistent implementation of relatedTarget across browsers we use the activeElement as a fallback\n    // if the related target is not part of the disclosed content we close the disclosed container\n    if (\n      !this._element.contains(\n        (event.relatedTarget as Node) || (document.activeElement as Node)\n      )\n    ) {\n      this.close();\n    }\n  }\n\n  @action\n  onKeyUp(event: KeyboardEvent): void {\n    if (event.key === 'Escape') {\n      this.close();\n      this.toggleRef?.focus();\n    }\n  }\n\n  @action\n  close(): void {\n    // we schedule this afterRender to avoid an error in tests caused by updating `isOpen` multiple times in the same computation\n    // eslint-disable-next-line ember/no-runloop\n    schedule('afterRender', (): void => {\n      this.isOpen = false;\n      // we call the \"onClose\" callback if it exists (and is a function)\n      if (this.args.onClose && typeof this.args.onClose === 'function') {\n        this.args.onClose();\n      }\n    });\n  }\n}\n"],"names":["MenuPrimitive","Component","g","prototype","tracked","i","void 0","constructor","owner","args","deprecate","id","until","url","for","since","enabled","available","didInsert","element","_element","n","action","onClickToggle","event","toggleRef","currentTarget","isOpen","focus","onFocusOut","contains","relatedTarget","document","activeElement","close","onKeyUp","key","schedule","onClose","setComponentTemplate","TEMPLATE"],"mappings":"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"}