{"version":3,"file":"index.js","sources":["../../../../src/components/hds/menu-primitive/index.hbs","../../../../src/components/hds/menu-primitive/index.js"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{! @glint-nocheck: not typesafe yet }}\\n{{!\\n  Copyright (c) HashiCorp, Inc.\\n  SPDX-License-Identifier: MPL-2.0\\n}}\\n{{! template-lint-disable no-invalid-interactive }}\\n<div\\n  class=\\\"hds-menu-primitive\\\"\\n  ...attributes\\n  {{did-insert this.didInsert}}\\n  {{on \\\"focusout\\\" this.onFocusOut}}\\n  {{on \\\"keyup\\\" this.onKeyUp}}\\n>\\n  <div class=\\\"hds-menu-primitive__toggle\\\" tabindex=\\\"-1\\\">\\n    {{yield (hash onClickToggle=this.onClickToggle isOpen=this.isOpen) to=\\\"toggle\\\"}}\\n  </div>\\n  {{#if this.isOpen}}\\n    <div class=\\\"hds-menu-primitive__content\\\" tabindex=\\\"-1\\\">\\n      {{yield (hash close=this.close) to=\\\"content\\\"}}\\n    </div>\\n  {{/if}}\\n</div>\\n{{! template-lint-enable no-invalid-interactive }}\")","/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { schedule } from '@ember/runloop';\n\nexport default class HdsMenuPrimitiveComponent extends Component {\n  @tracked isOpen; // notice: if in the future we need to add a \"@isOpen\" prop to control the status from outside (eg to have the MenuPrimitive opened on render) just add  \"this.args.isOpen\" here to initalize the variable\n  @tracked toggleRef;\n\n  @action\n  didInsert(element) {\n    this.element = element;\n  }\n\n  @action\n  onClickToggle(event) {\n    // we store a reference to the DOM node that has the \"onClickToggle\" event associated with it\n    if (!this.toggleRef) {\n      this.toggleRef = event.currentTarget;\n    }\n    this.isOpen = !this.isOpen;\n    // we explicitly apply a focus state to the toggle element to overcome a bug in WebKit (see https://github.com/hashicorp/design-system/commit/40cd7f6b3cb15c45f9a1235fafd0fb3ed58e6e62)\n    this.toggleRef.focus();\n  }\n\n  @action\n  onFocusOut(event) {\n    // due to inconsistent implementation of relatedTarget across browsers we use the activeElement as a fallback\n    // if the related target is not part of the disclosed content we close the disclosed container\n    if (!this.element.contains(event.relatedTarget || document.activeElement)) {\n      this.close();\n    }\n  }\n\n  @action\n  onKeyUp(event) {\n    if (event.key === 'Escape') {\n      this.close();\n      this.toggleRef.focus();\n    }\n  }\n\n  @action\n  close() {\n    // we schedule this afterRender to avoid an error in tests caused by updating `isOpen` multiple times in the same computation\n    schedule('afterRender', () => {\n      this.isOpen = false;\n      // we call the \"onClose\" callback if it exists (and is a function)\n      if (this.args.onClose && typeof this.args.onClose === 'function') {\n        this.args.onClose();\n      }\n    });\n  }\n}\n"],"names":["HdsMenuPrimitiveComponent","_class","Component","constructor","args","_initializerDefineProperty","_descriptor","_descriptor2","didInsert","element","onClickToggle","event","toggleRef","currentTarget","isOpen","focus","onFocusOut","contains","relatedTarget","document","activeElement","close","onKeyUp","key","schedule","onClose","_applyDecoratedDescriptor","prototype","tracked","configurable","enumerable","writable","initializer","action","Object","getOwnPropertyDescriptor","setComponentTemplate","TEMPLATE"],"mappings":"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"}