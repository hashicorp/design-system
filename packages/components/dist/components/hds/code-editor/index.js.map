{"version":3,"file":"index.js","sources":["../../../../src/components/hds/code-editor/index.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { modifier } from 'ember-modifier';\nimport { guidFor } from '@ember/object/internals';\n\nimport type Owner from '@ember/owner';\nimport type { ComponentLike } from '@glint/template';\nimport type { HdsCodeEditorSignature as HdsCodeEditorModifierSignature } from '../../../modifiers/hds-code-editor.ts';\nimport type { HdsCodeEditorDescriptionSignature } from './description';\nimport type { HdsCodeEditorTitleSignature } from './title';\nimport type { HdsCodeEditorGenericSignature } from './generic';\nimport type { EditorView } from '@codemirror/view';\nimport type { HdsCopyButtonSignature } from '../copy/button/index.ts';\n\nexport interface HdsCodeEditorSignature {\n  Args: {\n    hasCopyButton?: boolean;\n    hasFullScreenButton?: boolean;\n    isStandalone?: boolean;\n    copyButtonText?: HdsCopyButtonSignature['Args']['text'];\n  } & HdsCodeEditorModifierSignature['Args']['Named'];\n  Blocks: {\n    default: [\n      {\n        Title?: ComponentLike<HdsCodeEditorTitleSignature>;\n        Description?: ComponentLike<HdsCodeEditorDescriptionSignature>;\n        Generic?: ComponentLike<HdsCodeEditorGenericSignature>;\n      },\n    ];\n  };\n  Element: HTMLDivElement;\n}\n\nexport default class HdsCodeEditor extends Component<HdsCodeEditorSignature> {\n  @tracked private _isFullScreen = false;\n  @tracked private _isSetupComplete = false;\n  @tracked private _value;\n  @tracked private _titleId: string | undefined;\n  @tracked private _descriptionId: string | undefined;\n\n  private _id = guidFor(this);\n\n  private _handleEscape = modifier(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key !== 'Escape' || !this._isFullScreen) {\n        return;\n      }\n\n      this.toggleFullScreen();\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  });\n\n  constructor(owner: Owner, args: HdsCodeEditorSignature['Args']) {\n    super(owner, args);\n\n    if (args.value) {\n      this._value = args.value;\n    }\n  }\n\n  get ariaLabelledBy(): string | undefined {\n    if (this.args.ariaLabel !== undefined) {\n      return;\n    }\n\n    return this.args.ariaLabelledBy ?? this._titleId;\n  }\n\n  get ariaDescribedBy(): string | undefined {\n    return this.args.ariaDescribedBy ?? this._descriptionId;\n  }\n\n  get hasActions(): boolean {\n    return (this.args.hasCopyButton || this.args.hasFullScreenButton) ?? false;\n  }\n\n  get isStandalone(): boolean {\n    return this.args.isStandalone ?? true;\n  }\n\n  get classNames(): string {\n    // Currently there is only one theme so the class name is hard-coded.\n    // In the future, additional themes such as a \"light\" theme could be added.\n    const classes = ['hds-code-editor', 'hds-code-editor--theme-dark'];\n\n    if (this._isFullScreen) {\n      classes.push('hds-code-editor--is-full-screen');\n    }\n\n    if (this.isStandalone) {\n      classes.push('hds-code-editor--is-standalone');\n    }\n\n    return classes.join(' ');\n  }\n\n  get copyButtonText(): HdsCopyButtonSignature['Args']['text'] {\n    return this.args.copyButtonText ? this.args.copyButtonText : 'Copy';\n  }\n\n  @action\n  registerTitleElement(element: HdsCodeEditorTitleSignature['Element']): void {\n    this._titleId = element.id;\n  }\n\n  @action\n  registerDescriptionElement(\n    element: HdsCodeEditorDescriptionSignature['Element']\n  ): void {\n    this._descriptionId = element.id;\n  }\n\n  @action\n  toggleFullScreen(): void {\n    this._isFullScreen = !this._isFullScreen;\n  }\n\n  @action\n  onInput(newValue: string): void {\n    this._value = newValue;\n    this.args.onInput?.(newValue);\n  }\n\n  @action\n  onKeyDown(event: KeyboardEvent): void {\n    if (event.key === 'Escape' && this._isFullScreen) {\n      this.toggleFullScreen();\n    }\n  }\n\n  @action\n  onSetup(editorView: EditorView): void {\n    this._isSetupComplete = true;\n    this.args.onSetup?.(editorView);\n  }\n}\n"],"names":["HdsCodeEditor","Component","g","prototype","tracked","i","void 0","_id","guidFor","_handleEscape","modifier","handleKeyDown","event","key","_isFullScreen","toggleFullScreen","document","addEventListener","removeEventListener","constructor","owner","args","value","_value","ariaLabelledBy","ariaLabel","undefined","_titleId","ariaDescribedBy","_descriptionId","hasActions","hasCopyButton","hasFullScreenButton","isStandalone","classNames","classes","push","join","copyButtonText","registerTitleElement","element","id","n","action","registerDescriptionElement","onInput","newValue","onKeyDown","onSetup","editorView","_isSetupComplete","setComponentTemplate","TEMPLATE"],"mappings":"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"}