{"version":3,"file":"helpers.js","sources":["../../../../src/components/hds/table/helpers.ts"],"sourcesContent":["// TODO\n// did insert\n// add escape listener to focusable elements inside cell\n// Page Down: Moves focus down an author-determined number of rows, typically scrolling so the bottom row in the currently visible set of rows becomes one of the first visible rows. If focus is in the last row of the grid, focus does not move.\n// Page Up: Moves focus up an author-determined number of rows, typically scrolling so the top row in the currently visible set of rows becomes one of the last visible rows. If focus is in the first row of the grid, focus does not move.\n// Home: moves focus to the first cell in the row that contains focus.\n// End: moves focus to the last cell in the row that contains focus.\n// Control + Home: moves focus to the first cell in the first row.\n// Control + End: moves focus to the last cell in the last row.\n\nimport type { HdsTableTdSignature } from './td';\nimport type { HdsTableThSignature } from './th';\n\nexport const didInsertGridCell = (\n  cell: HdsTableThSignature['Element'] | HdsTableTdSignature['Element']\n): void => {\n  const currentRow = cell.parentElement;\n\n  if (currentRow?.parentElement?.tagName === 'THEAD') {\n    const thead = currentRow.parentElement;\n\n    if (\n      thead.children.item(0) === currentRow &&\n      currentRow.children.item(0) === cell\n    ) {\n      cell.setAttribute('tabindex', '0');\n    } else {\n      cell.setAttribute('tabindex', '-1');\n    }\n  } else if (currentRow?.parentElement?.tagName === 'TBODY') {\n    const table = currentRow.parentElement.parentElement;\n    const thead = table?.querySelector('thead');\n    const tbody = table?.querySelector('tbody');\n\n    if (thead === null) {\n      if (\n        tbody?.children.item(0) === currentRow &&\n        currentRow.children.item(0) === cell\n      ) {\n        cell.setAttribute('tabindex', '0');\n      }\n    } else {\n      cell.setAttribute('tabindex', '-1');\n    }\n  }\n};\n\nexport const handleGridCellKeyPress = (event: KeyboardEvent): void => {\n  const { key, target } = event;\n\n  const changeActiveCell = (oldCell: HTMLElement, newCell: HTMLElement) => {\n    newCell.setAttribute('tabindex', '0');\n    newCell.classList.add('hds-table__td--gridcell-active');\n\n    oldCell.setAttribute('tabindex', '-1');\n    oldCell.classList.remove('hds-table__td--gridcell-active');\n\n    newCell.focus();\n  };\n\n  if (target instanceof HTMLElement) {\n    if (key === 'Enter') {\n      const focusableElements = target.querySelectorAll(\n        'button, a[href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n      );\n\n      if (focusableElements.length === 1) {\n        const element = focusableElements[0] as HTMLElement;\n        element.click();\n      } else if (focusableElements.length > 1) {\n        const element = focusableElements[0] as HTMLElement;\n        element.focus();\n      }\n    } else if (event.key === 'ArrowRight' || event.key === 'ArrowLeft') {\n      const nextElement =\n        key === 'ArrowRight'\n          ? target.nextElementSibling\n          : target.previousElementSibling;\n\n      if (nextElement !== null && nextElement instanceof HTMLElement) {\n        changeActiveCell(target, nextElement);\n      }\n    } else if (event.key === 'ArrowDown' || event.key === 'ArrowUp') {\n      const currentRow = target.parentElement;\n\n      if (currentRow instanceof HTMLElement) {\n        const currentCellIndex = Array.from(currentRow.children).indexOf(\n          target\n        );\n        const nextRow =\n          key === 'ArrowDown'\n            ? currentRow.nextElementSibling\n            : currentRow.previousElementSibling;\n\n        if (nextRow !== null && nextRow instanceof HTMLElement) {\n          const nextCell = nextRow.children[currentCellIndex];\n          if (nextCell instanceof HTMLElement) {\n            changeActiveCell(target, nextCell);\n          }\n        } else {\n          if (currentRow?.parentElement?.tagName === 'TBODY') {\n            const thead = currentRow?.parentElement?.previousElementSibling;\n            const lastTheadRow = thead?.querySelector('tr:last-child');\n            const theadCell = lastTheadRow?.children[currentCellIndex];\n            if (key === 'ArrowUp' && theadCell instanceof HTMLElement) {\n              changeActiveCell(target, theadCell);\n            }\n          } else if (currentRow?.parentElement?.tagName === 'THEAD') {\n            const tbody = currentRow?.parentElement?.nextElementSibling;\n            const firstTbodyRow = tbody?.querySelector('tr:first-child');\n            const tbodyCell = firstTbodyRow?.children[currentCellIndex];\n            if (key === 'ArrowDown' && tbodyCell instanceof HTMLElement) {\n              changeActiveCell(target, tbodyCell);\n            }\n          }\n        }\n      }\n    }\n  }\n};\n"],"names":["didInsertGridCell","cell","currentRow","parentElement","tagName","thead","children","item","setAttribute","table","querySelector","tbody","handleGridCellKeyPress","event","key","target","changeActiveCell","oldCell","newCell","classList","add","remove","focus","HTMLElement","focusableElements","querySelectorAll","length","element","click","nextElement","nextElementSibling","previousElementSibling","currentCellIndex","Array","from","indexOf","nextRow","nextCell","lastTheadRow","theadCell","firstTbodyRow","tbodyCell"],"mappings":"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"}