{"version":3,"file":"index.js","sources":["../../../../src/components/hds/time/index.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport Component from '@glimmer/component';\nimport { typeOf } from '@ember/utils';\nimport { inject as service } from '@ember/service';\nimport { action } from '@ember/object';\nimport type { DisplayType } from '../../../services/hds-time-types.ts';\n\nimport type TimeService from '../../../services/hds-time';\n\nexport interface HdsTimeSignature {\n  Args: {\n    date?: Date | string;\n    startDate?: Date | string;\n    endDate?: Date | string;\n    display?:\n      | 'utc'\n      | 'relative'\n      | 'friendly-only'\n      | 'friendly-local'\n      | 'friendly-relative';\n    isOpen?: boolean;\n    hasTooltip?: boolean;\n    isoUtcString?: string;\n  };\n  Element: HTMLElement;\n}\n\nconst dateIsValid = (date?: Date | string): date is Date =>\n  date instanceof Date && !isNaN(+date);\n\nexport default class HdsTime extends Component<HdsTimeSignature> {\n  @service declare readonly hdsTime: TimeService;\n\n  get date(): Date | undefined {\n    const { date } = this.args;\n\n    // Sometimes an ISO date string might be passed in instead of a JS Date.\n    if (date) {\n      if (typeOf(date) === 'string') {\n        return new Date(date);\n      } else if (date instanceof Date) {\n        return date;\n      }\n    }\n  }\n\n  get startDate(): Date | undefined {\n    const { startDate } = this.args;\n\n    if (startDate) {\n      if (typeOf(startDate) === 'string') {\n        return new Date(startDate);\n      } else if (startDate instanceof Date) {\n        return startDate;\n      }\n    }\n  }\n\n  get endDate(): Date | undefined {\n    const { endDate } = this.args;\n\n    if (endDate) {\n      if (typeOf(endDate) === 'string') {\n        return new Date(endDate);\n      } else if (endDate instanceof Date) {\n        return endDate;\n      }\n    }\n  }\n\n  get isValidDate(): boolean {\n    return dateIsValid(this.date);\n  }\n\n  get isValidDateRange(): boolean {\n    if (dateIsValid(this.startDate) && dateIsValid(this.endDate)) {\n      return this.startDate <= this.endDate;\n    }\n    return false;\n  }\n\n  get hasTooltip(): boolean {\n    return this.args.hasTooltip ?? true;\n  }\n\n  get isoUtcString(): string {\n    const date = this.date;\n\n    if (dateIsValid(date)) {\n      const isoUtcString = this.hdsTime.toIsoUtcString(date);\n\n      if (isoUtcString) return isoUtcString;\n    }\n\n    return '';\n  }\n\n  get rangeIsoUtcString(): string {\n    const startDate = this.startDate;\n    const endDate = this.endDate;\n\n    if (dateIsValid(startDate) && dateIsValid(endDate)) {\n      return `${this.hdsTime.toIsoUtcString(startDate)}â€“${this.hdsTime.toIsoUtcString(endDate)}`;\n    }\n    return '';\n  }\n\n  get display(): DisplayType {\n    const date = this.date;\n    const { display } = this.args;\n\n    if (dateIsValid(date)) {\n      const nextDiff = this.hdsTime.timeDifference(this.hdsTime.now, date);\n      return this.hdsTime.format(nextDiff, display);\n    }\n    return {\n      options: undefined,\n      difference: { absValueInMs: 0, valueInMs: 0 },\n      relative: { value: 0, unit: undefined },\n    };\n  }\n\n  get isOpen(): boolean {\n    return this.args.isOpen ?? false;\n  }\n\n  @action\n  didInsertNode(): void {\n    const date = this.date;\n\n    if (dateIsValid(date)) {\n      this.hdsTime.register(date);\n    }\n  }\n\n  @action\n  willDestroyNode(): void {\n    const date = this.date;\n\n    if (dateIsValid(date)) {\n      this.hdsTime.unregister(date);\n    }\n  }\n}\n"],"names":["dateIsValid","date","Date","isNaN","HdsTime","Component","g","prototype","service","i","void 0","args","typeOf","startDate","endDate","isValidDate","isValidDateRange","hasTooltip","isoUtcString","hdsTime","toIsoUtcString","rangeIsoUtcString","display","nextDiff","timeDifference","now","format","options","undefined","difference","absValueInMs","valueInMs","relative","value","unit","isOpen","didInsertNode","register","n","action","willDestroyNode","unregister","setComponentTemplate","TEMPLATE"],"mappings":"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"}