{"version":3,"file":"index.js","sources":["../../../../../src/components/hds/pagination/numbered/index.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { assert } from '@ember/debug';\nimport { HdsPaginationDirectionValues } from '../types.ts';\n\nimport type {\n  HdsPaginationPage,\n  HdsPaginationRoutingProps,\n  HdsPaginationElliptizedPageArray,\n  HdsPaginationElliptizedPageArrayItem,\n} from '../types';\nimport type { HdsInteractiveSignature } from '../../interactive/index.ts';\nimport type Owner from '@ember/owner';\ninterface ElliptizeProps {\n  pages: number[];\n  current: number;\n  limit?: number;\n}\n\ntype HdsInteractiveQuery = HdsInteractiveSignature['Args']['query'];\n\ntype HdsPaginationNumberedRoutingQueryProps = HdsPaginationRoutingProps & {\n  queryNext?: HdsInteractiveQuery;\n  queryPrev?: HdsInteractiveQuery;\n  queryPages?: Record<\n    HdsPaginationElliptizedPageArrayItem,\n    HdsInteractiveQuery\n  >;\n};\n\ntype HdsPaginationQueryFunction = (\n  page: number,\n  pageSize: number\n) => HdsInteractiveQuery;\n\ninterface HdsPaginationNumberedArgs extends HdsPaginationRoutingProps {\n  ariaLabel?: string;\n  totalItems: number;\n  showLabels?: boolean;\n  isTruncated?: boolean;\n  currentPage?: number;\n  showInfo?: boolean;\n  showPageNumbers?: boolean;\n  showTotalItems?: boolean;\n  showSizeSelector?: boolean;\n  sizeSelectorLabel?: string;\n  pageSizes?: number[];\n  currentPageSize?: number;\n  queryFunction?: HdsPaginationQueryFunction;\n  onPageChange?: (page: number, pageSize: number) => unknown;\n  onPageSizeChange?: (pageSize: number) => unknown;\n}\n\ninterface HdsPaginationNumberedArgsControlledBase\n  extends HdsPaginationNumberedArgs {\n  currentPage: number;\n  currentPageSize: number;\n  queryFunction: HdsPaginationQueryFunction;\n}\n\ninterface HdsPaginationNumberedArgsControlledWithModel\n  extends HdsPaginationNumberedArgsControlledBase {\n  model: string | number;\n}\n\ninterface HdsPaginationNumberedArgsControlledWithModels\n  extends HdsPaginationNumberedArgsControlledBase {\n  models: Array<string | number>;\n}\ninterface HdsPaginationNumberedArgsControlledWithRoute\n  extends HdsPaginationNumberedArgsControlledBase {\n  route: string;\n}\n\ntype HdsPaginationNumberedArgsControlled =\n  | HdsPaginationNumberedArgsControlledWithModel\n  | HdsPaginationNumberedArgsControlledWithModels\n  | HdsPaginationNumberedArgsControlledWithRoute;\n\ninterface HdsPaginationNumberedArgsUncontrolled\n  extends HdsPaginationNumberedArgs {\n  queryFunction?: undefined;\n}\n\nexport interface HdsPaginationNumberedSignature {\n  Args:\n    | HdsPaginationNumberedArgsControlled\n    | HdsPaginationNumberedArgsUncontrolled;\n  Element: HTMLDivElement;\n}\n\nconst ELLIPSIS = 'â€¦';\n\n// for context about the decision to use these values, see:\n// https://hashicorp.slack.com/archives/C03A0N1QK8S/p1673546329082759\nexport const DEFAULT_PAGE_SIZES = [10, 30, 50];\n\nexport const elliptize = ({\n  pages,\n  current,\n  limit = 7,\n}: ElliptizeProps): HdsPaginationElliptizedPageArray => {\n  const length = pages.length;\n\n  let result = [];\n  let start;\n  let end;\n\n  if (length <= limit) {\n    return pages;\n  }\n\n  if (current <= length / 2) {\n    start = Math.ceil(limit / 2);\n    end = limit - start;\n  } else {\n    end = Math.ceil(limit / 2);\n    start = limit - end;\n  }\n\n  const sliceStart: HdsPaginationElliptizedPageArray = pages.slice(0, start);\n  const sliceEnd: HdsPaginationElliptizedPageArray = pages.slice(-end);\n\n  if (sliceStart.includes(current) && sliceStart.includes(current + 1)) {\n    // \"current\" (and its next sibling) is contained within the \"sliceStart\" block\n    sliceEnd.splice(0, 1, ELLIPSIS);\n    result = ([] as HdsPaginationElliptizedPageArray).concat(\n      sliceStart,\n      sliceEnd\n    );\n  } else if (sliceEnd.includes(current - 1) && sliceEnd.includes(current)) {\n    // \"current\" (and its prev sibling) is contained within the \"sliceEnd\" block\n    sliceStart.splice(-1, 1, ELLIPSIS);\n    result = ([] as HdsPaginationElliptizedPageArray).concat(\n      sliceStart,\n      sliceEnd\n    );\n  } else {\n    // this is a bit more tricky :)\n    // we need to calculate how many items there are before/after the current item\n    // since both the initial and ending blocks are always 2 items long (number + ellipsis)\n    // and there is always the \"current\" item, we can just subtract 5 from the limit\n    const delta = (limit - 5) / 2; // this is why the limit needs to be an odd number\n    // we slice the array starting at the \"current\" index, minus the delta, minus one because it's an array (zero-based)\n    const sliceCurr = pages.slice(current - delta - 1, current + delta);\n    result = ([] as HdsPaginationElliptizedPageArray).concat(\n      sliceStart.shift() as number,\n      ELLIPSIS,\n      sliceCurr,\n      ELLIPSIS,\n      sliceEnd.pop() as number\n    );\n  }\n\n  return result;\n};\nexport default class HdsPaginationNumbered extends Component<HdsPaginationNumberedSignature> {\n  // These two private variables are used to differentiate between\n  // \"uncontrolled\" component (where the state is handled internally) and\n  // \"controlled\" component (where the state is handled externally, by the consumer's code).\n  // In the first case, these variables store the internal state of the component at any moment,\n  // and their value is updated internally according to the user's interaction with the component.\n  // In the second case, these variables store *only* the initial state of the component (coming from the arguments)\n  // at rendering time, but from that moment on they're not updated anymore, no matter what interaction the user\n  // has with the component (the state is controlled externally, eg. via query parameters)\n  @tracked private _currentPage;\n  @tracked private _currentPageSize;\n  @tracked private _isControlled;\n\n  showInfo = this.args.showInfo ?? true; // if the \"info\" block is visible\n  showLabels = this.args.showLabels ?? false; // if the labels for the \"prev/next\" controls are visible\n  showSizeSelector = this.args.showSizeSelector ?? true; // if the \"size selector\" block is visible\n  showPageNumbers = this.args.showPageNumbers ?? true; // if the \"page numbers\" block is visible\n  isTruncated = this.args.isTruncated ?? true; // if the list of \"page numbers\" is truncated\n\n  constructor(owner: Owner, args: HdsPaginationNumberedSignature['Args']) {\n    super(owner, args);\n\n    const { queryFunction } = this.args;\n\n    // This component works in two different ways, depending if we need to support\n    // routing through links (`LinkTo`) for the \"navigation controls\", or not.\n    // If there's no routing then the component behaves as \"uncontrolled\"\n    // (the state updates - eg to the \"currentPage\" and \"currentPageSize\"\n    // are handled by its internal logic).\n    // If instead the component needs to update the routing (and we infer this via the \"query\" arguments)\n    // then the component behaves as \"controlled\", where the state is\n    // initialized and updated using the arguments passed to it.\n\n    if (queryFunction === undefined) {\n      this._isControlled = false;\n    } else {\n      assert(\n        '@model, @models, or @route for \"Hds::Pagination::Numbered\" must be provided when using the @queryFunction argument',\n        this.args.model !== undefined ||\n          this.args.models !== undefined ||\n          this.args.route !== undefined\n      );\n      assert(\n        '@queryFunction for \"Hds::Pagination::Numbered\" must be a function',\n        typeof queryFunction === 'function'\n      );\n      assert(\n        '@currentPage and @currentPageSize for \"Hds::Pagination::Numbered\" must be provided as numeric arguments when the pagination controls the routing',\n        typeof this.args.currentPageSize === 'number' &&\n          typeof this.args.currentPage === 'number'\n      );\n      this._isControlled = true;\n    }\n\n    assert(\n      '@totalItems for \"Hds::Pagination::Numbered\" must be defined as an integer number',\n      typeof this.args.totalItems === 'number'\n    );\n\n    this._currentPage = this.args.currentPage ?? 1;\n    // we assert that `this.pageSizes` will always be an array with at least one item\n    this._currentPageSize = this.args.currentPageSize ?? this.pageSizes[0];\n  }\n\n  get ariaLabel(): string {\n    return this.args.ariaLabel ?? 'Pagination';\n  }\n\n  // This very specific `get/set` pattern is used to handle the two different use cases of the component\n  // being \"controlled\" (when it has routing, meaning it needs to support pagination controls as links/`LinkTo`)\n  // vs being \"uncontrolled\" (see comments above for details).\n  //\n  // If it has routing (and so it's \"controlled\"), than the value (\"state\") of the `currentPage/currentPageSize` variables\n  // is *always* determined by the controller via arguments (most of the times, connected to query parameters in the URL).\n  // For this reason the \"get\" method always returns the value from the `args`,\n  // while the \"set\" method never updates the private internal state (_variable).\n  //\n  // If instead it doesn't have routing (and so it's \"uncontrolled\") than the value (\"state\") of the `currentPage/currentPageSize` variables\n  // is *always* determined by the component's internal logic (and updated according to the user interaction with it).\n  // For this reason the \"get\" and \"set\" methods always read from or write to the private internal state (_variable).\n\n  get currentPage(): number {\n    if (this._isControlled) {\n      // if the component is controlled, `@currentPage` is asserted to be a number\n      return this.args.currentPage as number;\n    } else {\n      return this._currentPage;\n    }\n  }\n  set currentPage(value) {\n    if (this._isControlled) {\n      // noop\n    } else {\n      // if `this._isControlled` is `false`\n      this._currentPage = value;\n    }\n  }\n\n  get currentPageSize(): number {\n    if (this._isControlled) {\n      // if the component is controlled, `@currentPageSize` is asserted to be a number\n      return this.args.currentPageSize as number;\n    } else {\n      return this._currentPageSize as number;\n    }\n  }\n  set currentPageSize(value) {\n    if (this._isControlled) {\n      // noop\n    } else {\n      this._currentPageSize = value;\n    }\n  }\n\n  get pageSizes(): number[] {\n    const { pageSizes = DEFAULT_PAGE_SIZES } = this.args;\n\n    assert(\n      // TODO: Add test for this\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      `pageSizes argument must be an array with at least one item. Received: ${pageSizes}`,\n      Array.isArray(pageSizes) === true && pageSizes.length > 0\n    );\n\n    return pageSizes;\n  }\n\n  get itemsRangeStart(): number {\n    // Calculate the starting range of items displayed on current page\n    // if currentPage = 1st page and # of items per page is 10:\n    //  ( (1 - 1 = 0) * 10 = 0 ) + 1 = 1\n    // if current page = 2nd page:\n    // ( (2 - 1 = 1) * 10 = 10 ) + 1 = 11\n    return (this.currentPage - 1) * this.currentPageSize + 1;\n  }\n\n  get itemsRangeEnd(): number {\n    // Calculate ending range of items displayed on current page\n    // 2 cases: 1) full page of items or 2) last page of items\n    if (this.currentPage * this.currentPageSize < this.args.totalItems) {\n      // 1) full page of items (pages 1 to page before last):\n      return this.itemsRangeStart + this.currentPageSize - 1;\n    } else {\n      // 2) last page of items:\n      return this.args.totalItems;\n    }\n  }\n\n  get pages(): HdsPaginationElliptizedPageArray {\n    const pages = [];\n\n    for (let i = 1; i <= this.totalPages; i++) {\n      pages.push(i);\n    }\n\n    if (this.isTruncated) {\n      return elliptize({ pages, current: this.currentPage });\n    } else {\n      return pages;\n    }\n  }\n\n  get totalPages() {\n    return Math.max(Math.ceil(this.args.totalItems / this.currentPageSize), 1);\n  }\n\n  buildQueryParamsObject(\n    page: HdsPaginationElliptizedPageArrayItem,\n    pageSize: number\n  ): HdsInteractiveQuery {\n    // `page` may also be ellipsis\n    if (this._isControlled && typeof page === 'number') {\n      // if the component is controlled, `@queryFunction` is asserted to be a function\n      return this.args.queryFunction!(page, pageSize);\n    } else {\n      return {};\n    }\n  }\n\n  get routing(): HdsPaginationNumberedRoutingQueryProps {\n    const routing: HdsPaginationNumberedRoutingQueryProps = {\n      route: this.args.route ?? undefined,\n      model: this.args.model ?? undefined,\n      models: this.args.models ?? undefined,\n      replace: this.args.replace ?? undefined,\n    };\n\n    // the \"query\" is dynamic and needs to be calculated\n    if (this._isControlled) {\n      routing.queryPrev = this.buildQueryParamsObject(\n        this.currentPage - 1,\n        this.currentPageSize\n      );\n      routing.queryNext = this.buildQueryParamsObject(\n        this.currentPage + 1,\n        this.currentPageSize\n      );\n      // IMPORTANT: here we need to use an object and not an array\n      // otherwise the {{get object page}} will be shifted by one\n      // (the pages are 1-based while the array would be zero-based)\n      routing.queryPages = {};\n      this.pages.forEach(\n        (page) =>\n          (routing.queryPages![page] = this.buildQueryParamsObject(\n            page,\n            this.currentPageSize\n          ))\n      );\n    } else {\n      routing.queryPrev = undefined;\n      routing.queryNext = undefined;\n    }\n\n    return routing;\n  }\n\n  get isDisabledPrev() {\n    return this.currentPage === 1;\n  }\n\n  get isDisabledNext() {\n    return this.currentPage === this.totalPages;\n  }\n\n  @action\n  onPageChange(page: HdsPaginationPage) {\n    let gotoPageNumber;\n    if (page === HdsPaginationDirectionValues.Prev && this.currentPage > 1) {\n      gotoPageNumber = this.currentPage - 1;\n    } else if (\n      page === HdsPaginationDirectionValues.Next &&\n      this.currentPage < this.totalPages\n    ) {\n      gotoPageNumber = this.currentPage + 1;\n    } else {\n      gotoPageNumber = page;\n    }\n\n    // we want to invoke the `onPageChange` callback only on actual page change\n    if (gotoPageNumber !== this.currentPage) {\n      // we have already determined that `gotoPageNumber` is not `prev` or `next`\n      this.currentPage = gotoPageNumber as number;\n\n      const { onPageChange } = this.args;\n\n      if (typeof onPageChange === 'function') {\n        onPageChange(this.currentPage, this.currentPageSize);\n      }\n    }\n  }\n\n  @action\n  onPageSizeChange(newPageSize: number) {\n    const { onPageSizeChange } = this.args;\n\n    if (!this._isControlled) {\n      // notice: we agreed to reset the pagination to the first element (any alternative would result in an unpredictable UX)\n      this.currentPage = 1;\n      this.currentPageSize = newPageSize;\n    }\n\n    // invoke the callback function\n    if (typeof onPageSizeChange === 'function') {\n      onPageSizeChange(newPageSize);\n    }\n  }\n\n  elliptizedPageArrayItemAsNumber = (\n    item: HdsPaginationElliptizedPageArrayItem\n  ): number => {\n    if (typeof item === 'number') {\n      return item;\n    } else {\n      throw new Error('Expected a number, but got an ellipsis');\n    }\n  };\n\n  getPageNumberQuery(page: HdsPaginationElliptizedPageArrayItem) {\n    return this.routing.queryPages![this.elliptizedPageArrayItemAsNumber(page)];\n  }\n}\n"],"names":["ELLIPSIS","DEFAULT_PAGE_SIZES","elliptize","pages","current","limit","length","result","start","end","Math","ceil","sliceStart","slice","sliceEnd","includes","splice","concat","delta","sliceCurr","shift","pop","HdsPaginationNumbered","Component","g","prototype","tracked","i","void 0","showInfo","args","showLabels","showSizeSelector","showPageNumbers","isTruncated","constructor","owner","queryFunction","undefined","_isControlled","assert","model","models","route","currentPageSize","currentPage","totalItems","_currentPage","_currentPageSize","pageSizes","ariaLabel","value","Array","isArray","itemsRangeStart","itemsRangeEnd","totalPages","push","max","buildQueryParamsObject","page","pageSize","routing","replace","queryPrev","queryNext","queryPages","forEach","isDisabledPrev","isDisabledNext","onPageChange","gotoPageNumber","HdsPaginationDirectionValues","Prev","Next","n","action","onPageSizeChange","newPageSize","elliptizedPageArrayItemAsNumber","item","Error","getPageNumberQuery","setComponentTemplate","TEMPLATE"],"mappings":"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"}