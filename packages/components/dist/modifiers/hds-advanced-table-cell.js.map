{"version":3,"file":"hds-advanced-table-cell.js","sources":["../../src/modifiers/hds-advanced-table-cell.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport Modifier from 'ember-modifier';\nimport type { ArgsFor, PositionalArgs } from 'ember-modifier';\nimport { registerDestructor } from '@ember/destroyable';\n\nimport {\n  didInsertGridCell,\n  updateTabbableChildren,\n} from './hds-advanced-table-cell/dom-management.ts';\nimport { handleGridCellKeyPress } from './hds-advanced-table-cell/keyboard-navigation.ts';\nimport type Owner from '@ember/owner';\n\nexport interface HdsAdvancedTableCellModifierSignature {\n  Args: {\n    Named: {\n      handleEnableFocusTrap: () => void;\n      shouldTrapFocus: boolean;\n      setCellElement: (el: HTMLDivElement) => void;\n    };\n  };\n  Element: HTMLDivElement;\n}\n\nfunction cleanup(instance: HdsAdvancedTableCellModifier): void {\n  const { _observer } = instance;\n  if (_observer) {\n    _observer.disconnect();\n  }\n}\n\nexport default class HdsAdvancedTableCellModifier extends Modifier<HdsAdvancedTableCellModifierSignature> {\n  // have a copy of shouldTrapFocus internally so the correct value is used when update tabbable children\n  private _shouldTrapFocus = false;\n  private _didSetup = false;\n  _observer: MutationObserver | undefined = undefined;\n\n  constructor(\n    owner: Owner,\n    args: ArgsFor<HdsAdvancedTableCellModifierSignature>\n  ) {\n    super(owner, args);\n    registerDestructor(this, cleanup);\n  }\n\n  modify(\n    element: HTMLDivElement,\n    positional: PositionalArgs<HdsAdvancedTableCellModifierSignature>,\n    named: HdsAdvancedTableCellModifierSignature['Args']['Named']\n  ): void {\n    this._shouldTrapFocus = named.shouldTrapFocus;\n\n    if (!this._didSetup) {\n      this.#setupObserver(element, positional, named);\n      named.setCellElement(element);\n      this._didSetup = true;\n    }\n  }\n\n  #setupObserver(\n    element: HdsAdvancedTableCellModifierSignature['Element'],\n    _positional: PositionalArgs<HdsAdvancedTableCellModifierSignature>,\n    named: HdsAdvancedTableCellModifierSignature['Args']['Named']\n  ): void {\n    const { handleEnableFocusTrap } = named;\n\n    didInsertGridCell(element);\n    element.addEventListener('keydown', (event: KeyboardEvent) => {\n      handleGridCellKeyPress(event, handleEnableFocusTrap);\n    });\n\n    this._observer = new MutationObserver(() => {\n      updateTabbableChildren(element, this._shouldTrapFocus);\n    });\n\n    this._observer.observe(element, {\n      childList: true,\n      subtree: true,\n    });\n  }\n}\n"],"names":["cleanup","instance","_observer","disconnect","_HdsAdvancedTableCellModifier_brand","WeakSet","HdsAdvancedTableCellModifier","Modifier","constructor","owner","args","_classPrivateMethodInitSpec","_defineProperty","undefined","registerDestructor","modify","element","positional","named","_shouldTrapFocus","shouldTrapFocus","_didSetup","_assertClassBrand","_setupObserver","call","setCellElement","_positional","handleEnableFocusTrap","didInsertGridCell","addEventListener","event","handleGridCellKeyPress","MutationObserver","updateTabbableChildren","observe","childList","subtree"],"mappings":";;;;;;AA2BA,SAASA,OAAOA,CAACC,QAAsC,EAAQ;EAC7D,MAAM;AAAEC,IAAAA;AAAU,GAAC,GAAGD,QAAQ;AAC9B,EAAA,IAAIC,SAAS,EAAE;IACbA,SAAS,CAACC,UAAU,EAAE;AACxB;AACF;AAAC,IAAAC,mCAAA,oBAAAC,OAAA,EAAA;AAEc,MAAMC,4BAA4B,SAASC,QAAQ,CAAwC;AAMxGC,EAAAA,WAAWA,CACTC,KAAY,EACZC,IAAoD,EACpD;AACA,IAAA,KAAK,CAACD,KAAK,EAAEC,IAAI,CAAC;AAACC,IAAAA,2BAAA,OAAAP,mCAAA,CAAA;AATrB;AAAAQ,IAAAA,eAAA,2BAC2B,KAAK,CAAA;AAAAA,IAAAA,eAAA,oBACZ,KAAK,CAAA;AAAAA,IAAAA,eAAA,oBACiBC,SAAS,CAAA;AAOjDC,IAAAA,kBAAkB,CAAC,IAAI,EAAEd,OAAO,CAAC;AACnC;AAEAe,EAAAA,MAAMA,CACJC,OAAuB,EACvBC,UAAiE,EACjEC,KAA6D,EACvD;AACN,IAAA,IAAI,CAACC,gBAAgB,GAAGD,KAAK,CAACE,eAAe;AAE7C,IAAA,IAAI,CAAC,IAAI,CAACC,SAAS,EAAE;AACnBC,MAAAA,iBAAA,CAAAlB,mCAAA,EAAI,IAAA,EAACmB,cAAa,CAAC,CAAAC,IAAA,CAAnB,IAAI,EAAgBR,OAAO,EAAEC,UAAU,EAAEC,KAAK,CAAA;AAC9CA,MAAAA,KAAK,CAACO,cAAc,CAACT,OAAO,CAAC;MAC7B,IAAI,CAACK,SAAS,GAAG,IAAI;AACvB;AACF;AAuBF;AAAC,SAAAE,eApBGP,OAAyD,EACzDU,WAAkE,EAClER,KAA6D,EACvD;EACN,MAAM;AAAES,IAAAA;AAAsB,GAAC,GAAGT,KAAK;EAEvCU,iBAAiB,CAACZ,OAAO,CAAC;AAC1BA,EAAAA,OAAO,CAACa,gBAAgB,CAAC,SAAS,EAAGC,KAAoB,IAAK;AAC5DC,IAAAA,sBAAsB,CAACD,KAAK,EAAEH,qBAAqB,CAAC;AACtD,GAAC,CAAC;AAEF,EAAA,IAAI,CAACzB,SAAS,GAAG,IAAI8B,gBAAgB,CAAC,MAAM;AAC1CC,IAAAA,sBAAsB,CAACjB,OAAO,EAAE,IAAI,CAACG,gBAAgB,CAAC;AACxD,GAAC,CAAC;AAEF,EAAA,IAAI,CAACjB,SAAS,CAACgC,OAAO,CAAClB,OAAO,EAAE;AAC9BmB,IAAAA,SAAS,EAAE,IAAI;AACfC,IAAAA,OAAO,EAAE;AACX,GAAC,CAAC;AACJ;;;;"}