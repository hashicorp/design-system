{"version":3,"file":"hds-advanced-table-cell.js","sources":["../../src/modifiers/hds-advanced-table-cell.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport Modifier from 'ember-modifier';\nimport type { ArgsFor, PositionalArgs } from 'ember-modifier';\nimport { registerDestructor } from '@ember/destroyable';\n\nimport {\n  didInsertGridCell,\n  updateTabbableChildren,\n} from './hds-advanced-table-cell/dom-management.ts';\nimport { handleGridCellKeyPress } from './hds-advanced-table-cell/keyboard-navigation.ts';\nimport type Owner from '@ember/owner';\n\nexport interface HdsAdvancedTableCellModifierSignature {\n  Args: {\n    Named: {\n      handleEnableFocusTrap: () => void;\n      shouldTrapFocus: boolean;\n      setCellElement: (el: HTMLDivElement) => void;\n    };\n  };\n  Element: HTMLDivElement;\n}\n\nexport default class HdsAdvancedTableCellModifier extends Modifier<HdsAdvancedTableCellModifierSignature> {\n  // have a copy of shouldTrapFocus internally so the correct value is used when update tabbable children\n  private _shouldTrapFocus = false;\n  private _didSetup = false;\n  private _element: HTMLDivElement | undefined = undefined;\n  private _observer: MutationObserver | undefined = undefined;\n  private _keydownHandler!: (event: KeyboardEvent) => void;\n\n  constructor(\n    owner: Owner,\n    args: ArgsFor<HdsAdvancedTableCellModifierSignature>\n  ) {\n    super(owner, args);\n\n    registerDestructor(this, () => {\n      this._observer?.disconnect();\n      this._element?.removeEventListener('keydown', this._keydownHandler);\n      this._element = undefined;\n    });\n  }\n\n  modify(\n    element: HTMLDivElement,\n    positional: PositionalArgs<HdsAdvancedTableCellModifierSignature>,\n    named: HdsAdvancedTableCellModifierSignature['Args']['Named']\n  ): void {\n    this._shouldTrapFocus = named.shouldTrapFocus;\n\n    if (!this._didSetup) {\n      this.#setupObserver(element, positional, named);\n      named.setCellElement(element);\n      this._didSetup = true;\n      this._element = element;\n    }\n  }\n\n  #setupObserver(\n    element: HdsAdvancedTableCellModifierSignature['Element'],\n    _positional: PositionalArgs<HdsAdvancedTableCellModifierSignature>,\n    named: HdsAdvancedTableCellModifierSignature['Args']['Named']\n  ): void {\n    const { handleEnableFocusTrap } = named;\n    didInsertGridCell(element);\n\n    this._keydownHandler = (event: KeyboardEvent) => {\n      handleGridCellKeyPress(event, handleEnableFocusTrap);\n    };\n    element.addEventListener('keydown', this._keydownHandler);\n\n    this._observer = new MutationObserver(() => {\n      updateTabbableChildren(element, this._shouldTrapFocus);\n    });\n    this._observer.observe(element, {\n      childList: true,\n      subtree: true,\n    });\n  }\n}\n"],"names":["HdsAdvancedTableCellModifier","Modifier","_shouldTrapFocus","_didSetup","_element","undefined","_observer","_keydownHandler","constructor","owner","args","registerDestructor","disconnect","removeEventListener","modify","element","positional","named","shouldTrapFocus","setCellElement","#setupObserver","_positional","handleEnableFocusTrap","didInsertGridCell","event","handleGridCellKeyPress","addEventListener","MutationObserver","updateTabbableChildren","observe","childList","subtree"],"mappings":";;;;;AAAA;AACA;AACA;AACA;;AAwBe,MAAMA,4BAA4B,SAASC,QAAQ,CAAwC;AACxG;AACQC,EAAAA,gBAAgB,GAAG,KAAK;AACxBC,EAAAA,SAAS,GAAG,KAAK;AACjBC,EAAAA,QAAQ,GAA+BC,SAAS;AAChDC,EAAAA,SAAS,GAAiCD,SAAS;EACnDE,eAAe;AAEvBC,EAAAA,WAAWA,CACTC,KAAY,EACZC,IAAoD,EACpD;AACA,IAAA,KAAK,CAACD,KAAK,EAAEC,IAAI,CAAC;IAElBC,kBAAkB,CAAC,IAAI,EAAE,MAAM;AAC7B,MAAA,IAAI,CAACL,SAAS,EAAEM,UAAU,EAAE;MAC5B,IAAI,CAACR,QAAQ,EAAES,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAACN,eAAe,CAAC;MACnE,IAAI,CAACH,QAAQ,GAAGC,SAAS;AAC3B,KAAC,CAAC;AACJ;AAEAS,EAAAA,MAAMA,CACJC,OAAuB,EACvBC,UAAiE,EACjEC,KAA6D,EACvD;AACN,IAAA,IAAI,CAACf,gBAAgB,GAAGe,KAAK,CAACC,eAAe;AAE7C,IAAA,IAAI,CAAC,IAAI,CAACf,SAAS,EAAE;MACnB,IAAI,CAAC,cAAc,CAACY,OAAO,EAAEC,UAAU,EAAEC,KAAK,CAAC;AAC/CA,MAAAA,KAAK,CAACE,cAAc,CAACJ,OAAO,CAAC;MAC7B,IAAI,CAACZ,SAAS,GAAG,IAAI;MACrB,IAAI,CAACC,QAAQ,GAAGW,OAAO;AACzB;AACF;AAEA,EAAA,cAAcK,CACZL,OAAyD,EACzDM,WAAkE,EAClEJ,KAA6D,EACvD;IACN,MAAM;AAAEK,MAAAA;AAAsB,KAAC,GAAGL,KAAK;IACvCM,iBAAiB,CAACR,OAAO,CAAC;AAE1B,IAAA,IAAI,CAACR,eAAe,GAAIiB,KAAoB,IAAK;AAC/CC,MAAAA,sBAAsB,CAACD,KAAK,EAAEF,qBAAqB,CAAC;KACrD;IACDP,OAAO,CAACW,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAACnB,eAAe,CAAC;AAEzD,IAAA,IAAI,CAACD,SAAS,GAAG,IAAIqB,gBAAgB,CAAC,MAAM;AAC1CC,MAAAA,sBAAsB,CAACb,OAAO,EAAE,IAAI,CAACb,gBAAgB,CAAC;AACxD,KAAC,CAAC;AACF,IAAA,IAAI,CAACI,SAAS,CAACuB,OAAO,CAACd,OAAO,EAAE;AAC9Be,MAAAA,SAAS,EAAE,IAAI;AACfC,MAAAA,OAAO,EAAE;AACX,KAAC,CAAC;AACJ;AACF;;;;"}