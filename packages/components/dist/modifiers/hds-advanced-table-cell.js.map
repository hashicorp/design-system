{"version":3,"file":"hds-advanced-table-cell.js","sources":["../../src/modifiers/hds-advanced-table-cell.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport Modifier from 'ember-modifier';\nimport type { ArgsFor, PositionalArgs } from 'ember-modifier';\nimport { registerDestructor } from '@ember/destroyable';\n\nimport {\n  didInsertGridCell,\n  updateTabbableChildren,\n} from './hds-advanced-table-cell/dom-management.ts';\nimport { handleGridCellKeyPress } from './hds-advanced-table-cell/keyboard-navigation.ts';\nimport type Owner from '@ember/owner';\n\nexport interface HdsAdvancedTableCellModifierSignature {\n  Args: {\n    Named: {\n      handleEnableFocusTrap: () => void;\n      shouldTrapFocus: boolean;\n      setCellElement: (el: HTMLDivElement) => void;\n    };\n  };\n  Element: HTMLDivElement;\n}\n\nfunction cleanup(instance: HdsAdvancedTableCellModifier): void {\n  const { _observer } = instance;\n  if (_observer) {\n    _observer.disconnect();\n  }\n}\n\nexport default class HdsAdvancedTableCellModifier extends Modifier<HdsAdvancedTableCellModifierSignature> {\n  // have a copy of shouldTrapFocus internally so the correct value is used when update tabbable children\n  private _shouldTrapFocus = false;\n  private _didSetup = false;\n  _observer: MutationObserver | undefined = undefined;\n\n  constructor(\n    owner: Owner,\n    args: ArgsFor<HdsAdvancedTableCellModifierSignature>\n  ) {\n    super(owner, args);\n    registerDestructor(this, cleanup);\n  }\n\n  modify(\n    element: HTMLDivElement,\n    positional: PositionalArgs<HdsAdvancedTableCellModifierSignature>,\n    named: HdsAdvancedTableCellModifierSignature['Args']['Named']\n  ): void {\n    this._shouldTrapFocus = named.shouldTrapFocus;\n\n    if (!this._didSetup) {\n      this.#setupObserver(element, positional, named);\n      named.setCellElement(element);\n      this._didSetup = true;\n    }\n  }\n\n  #setupObserver(\n    element: HdsAdvancedTableCellModifierSignature['Element'],\n    _positional: PositionalArgs<HdsAdvancedTableCellModifierSignature>,\n    named: HdsAdvancedTableCellModifierSignature['Args']['Named']\n  ): void {\n    const { handleEnableFocusTrap } = named;\n\n    didInsertGridCell(element);\n    element.addEventListener('keydown', (event: KeyboardEvent) => {\n      handleGridCellKeyPress(event, handleEnableFocusTrap);\n    });\n\n    this._observer = new MutationObserver(() => {\n      updateTabbableChildren(element, this._shouldTrapFocus);\n    });\n\n    this._observer.observe(element, {\n      childList: true,\n      subtree: true,\n    });\n  }\n}\n"],"names":["cleanup","instance","_observer","disconnect","HdsAdvancedTableCellModifier","Modifier","_shouldTrapFocus","_didSetup","undefined","constructor","owner","args","registerDestructor","modify","element","positional","named","shouldTrapFocus","setCellElement","#setupObserver","_positional","handleEnableFocusTrap","didInsertGridCell","addEventListener","event","handleGridCellKeyPress","MutationObserver","updateTabbableChildren","observe","childList","subtree"],"mappings":";;;;;AAAA;AACA;AACA;AACA;;AAwBA,SAASA,OAAOA,CAACC,QAAsC,EAAQ;EAC7D,MAAM;AAAEC,IAAAA;AAAU,GAAC,GAAGD,QAAQ;AAC9B,EAAA,IAAIC,SAAS,EAAE;IACbA,SAAS,CAACC,UAAU,EAAE;AACxB;AACF;AAEe,MAAMC,4BAA4B,SAASC,QAAQ,CAAwC;AACxG;AACQC,EAAAA,gBAAgB,GAAG,KAAK;AACxBC,EAAAA,SAAS,GAAG,KAAK;AACzBL,EAAAA,SAAS,GAAiCM,SAAS;AAEnDC,EAAAA,WAAWA,CACTC,KAAY,EACZC,IAAoD,EACpD;AACA,IAAA,KAAK,CAACD,KAAK,EAAEC,IAAI,CAAC;AAClBC,IAAAA,kBAAkB,CAAC,IAAI,EAAEZ,OAAO,CAAC;AACnC;AAEAa,EAAAA,MAAMA,CACJC,OAAuB,EACvBC,UAAiE,EACjEC,KAA6D,EACvD;AACN,IAAA,IAAI,CAACV,gBAAgB,GAAGU,KAAK,CAACC,eAAe;AAE7C,IAAA,IAAI,CAAC,IAAI,CAACV,SAAS,EAAE;MACnB,IAAI,CAAC,cAAc,CAACO,OAAO,EAAEC,UAAU,EAAEC,KAAK,CAAC;AAC/CA,MAAAA,KAAK,CAACE,cAAc,CAACJ,OAAO,CAAC;MAC7B,IAAI,CAACP,SAAS,GAAG,IAAI;AACvB;AACF;AAEA,EAAA,cAAcY,CACZL,OAAyD,EACzDM,WAAkE,EAClEJ,KAA6D,EACvD;IACN,MAAM;AAAEK,MAAAA;AAAsB,KAAC,GAAGL,KAAK;IAEvCM,iBAAiB,CAACR,OAAO,CAAC;AAC1BA,IAAAA,OAAO,CAACS,gBAAgB,CAAC,SAAS,EAAGC,KAAoB,IAAK;AAC5DC,MAAAA,sBAAsB,CAACD,KAAK,EAAEH,qBAAqB,CAAC;AACtD,KAAC,CAAC;AAEF,IAAA,IAAI,CAACnB,SAAS,GAAG,IAAIwB,gBAAgB,CAAC,MAAM;AAC1CC,MAAAA,sBAAsB,CAACb,OAAO,EAAE,IAAI,CAACR,gBAAgB,CAAC;AACxD,KAAC,CAAC;AAEF,IAAA,IAAI,CAACJ,SAAS,CAAC0B,OAAO,CAACd,OAAO,EAAE;AAC9Be,MAAAA,SAAS,EAAE,IAAI;AACfC,MAAAA,OAAO,EAAE;AACX,KAAC,CAAC;AACJ;AACF;;;;"}