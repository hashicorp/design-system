{"version":3,"file":"keyboard-navigation.js","sources":["../../../src/modifiers/hds-advanced-table-cell/keyboard-navigation.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport { focusable } from 'tabbable';\n\nexport const handleGridCellKeyPress = (\n  event: KeyboardEvent,\n  enableFocusTrap: () => void\n): void => {\n  const { key, target } = event;\n\n  const changeActiveCell = (oldCell: HTMLElement, newCell: HTMLElement) => {\n    oldCell.setAttribute('tabindex', '-1');\n    newCell.setAttribute('tabindex', '0');\n    newCell.focus();\n  };\n\n  const findNewRow = (\n    currentRow: HTMLElement,\n    direction: 'ArrowDown' | 'ArrowUp'\n  ) => {\n    const grid = currentRow.parentElement?.closest('[role=\"grid\"]');\n    const allRows = grid?.querySelectorAll('[role=\"row\"]');\n\n    if (allRows) {\n      const currentRowIndex = Array.from(allRows).indexOf(currentRow);\n      if (direction === 'ArrowDown') return allRows[currentRowIndex + 1];\n      else if (direction === 'ArrowUp') return allRows[currentRowIndex - 1];\n    }\n  };\n\n  if (\n    target instanceof HTMLElement &&\n    (target.classList.contains('hds-advanced-table__th') ||\n      target.classList.contains('hds-advanced-table__td'))\n  ) {\n    if (key === 'Enter') {\n      const cellFocusableChildren = focusable(target);\n\n      if (cellFocusableChildren.length > 0) {\n        for (let i = 0; i < cellFocusableChildren.length; i++) {\n          const child = cellFocusableChildren[i];\n          if (child?.hasAttribute('data-advanced-table-child-focusable')) {\n            child.setAttribute('tabindex', '0');\n          }\n        }\n        target.setAttribute('tabindex', '-1');\n        enableFocusTrap();\n      }\n    } else if (event.key === 'ArrowRight' || event.key === 'ArrowLeft') {\n      event.preventDefault();\n      const nextElement =\n        key === 'ArrowRight'\n          ? target.nextElementSibling\n          : target.previousElementSibling;\n\n      if (nextElement !== null && nextElement instanceof HTMLElement) {\n        changeActiveCell(target, nextElement);\n      }\n    } else if (event.key === 'ArrowDown' || event.key === 'ArrowUp') {\n      event.preventDefault();\n      const currentRow = target.parentElement;\n\n      if (currentRow instanceof HTMLElement) {\n        const currentCellIndex = Array.from(currentRow.children).indexOf(\n          target\n        );\n        const nextRow = findNewRow(currentRow, event.key);\n\n        if (nextRow !== null && nextRow instanceof HTMLElement) {\n          const nextCell = nextRow.children[currentCellIndex];\n          if (nextCell instanceof HTMLElement) {\n            changeActiveCell(target, nextCell);\n          }\n        }\n      }\n    } else if (event.key === 'Home' || event.key === 'End') {\n      event.preventDefault();\n      if (event.ctrlKey) {\n        const table = target.parentElement?.closest('[role=\"grid\"]');\n        const allRows = table?.querySelectorAll('[role=\"row\"]');\n\n        if (allRows) {\n          const nextRow =\n            key === 'Home' ? allRows[0] : allRows[allRows.length - 1];\n\n          if (nextRow) {\n            const cellsInNextRow = nextRow.children;\n            const nextElement =\n              key === 'Home'\n                ? cellsInNextRow[0]\n                : cellsInNextRow[cellsInNextRow.length - 1];\n\n            if (nextElement && nextElement instanceof HTMLElement) {\n              changeActiveCell(target, nextElement);\n            }\n          }\n        }\n      } else {\n        const currentRow = target.parentElement;\n\n        if (currentRow) {\n          const allCells = currentRow.children;\n          const nextElement =\n            key === 'Home' ? allCells[0] : allCells[allCells.length - 1];\n\n          if (nextElement && nextElement instanceof HTMLElement) {\n            changeActiveCell(target, nextElement);\n          }\n        }\n      }\n    } else if (event.key === 'PageUp' || event.key === 'PageDown') {\n      event.preventDefault();\n      const currentRow = target.parentElement;\n\n      if (currentRow instanceof HTMLElement) {\n        const currentCellIndex = Array.from(currentRow.children).indexOf(\n          target\n        );\n\n        const grid = currentRow.parentElement?.closest('[role=\"grid\"]');\n        const allRows = grid?.querySelectorAll('[role=\"row\"]');\n\n        if (allRows) {\n          const nextRow =\n            event.key === 'PageUp' ? allRows[0] : allRows[allRows.length - 1];\n\n          if (nextRow !== null && nextRow instanceof HTMLElement) {\n            const nextCell = nextRow.children[currentCellIndex];\n            if (nextCell instanceof HTMLElement) {\n              changeActiveCell(target, nextCell);\n            }\n          }\n        }\n      }\n    }\n  }\n};\n"],"names":["handleGridCellKeyPress","event","enableFocusTrap","key","target","changeActiveCell","oldCell","newCell","setAttribute","focus","findNewRow","currentRow","direction","grid","parentElement","closest","allRows","querySelectorAll","currentRowIndex","Array","from","indexOf","HTMLElement","classList","contains","cellFocusableChildren","focusable","length","i","child","hasAttribute","preventDefault","nextElement","nextElementSibling","previousElementSibling","currentCellIndex","children","nextRow","nextCell","ctrlKey","table","cellsInNextRow","allCells"],"mappings":"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"}