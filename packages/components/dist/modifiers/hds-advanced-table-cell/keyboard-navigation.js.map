{"version":3,"file":"keyboard-navigation.js","sources":["../../../src/modifiers/hds-advanced-table-cell/keyboard-navigation.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport { focusable } from 'tabbable';\n\nexport const handleGridCellKeyPress = (\n  event: KeyboardEvent,\n  enableFocusTrap: () => void\n): void => {\n  const { key, target } = event;\n\n  const changeActiveCell = (oldCell: HTMLElement, newCell: HTMLElement) => {\n    oldCell.setAttribute('tabindex', '-1');\n    newCell.setAttribute('tabindex', '0');\n    newCell.scrollIntoView({\n      behavior: 'smooth',\n      block: 'center',\n      inline: 'center',\n    });\n    newCell.focus({ preventScroll: true });\n  };\n\n  const findNewRow = (\n    currentRow: HTMLElement,\n    direction: 'ArrowDown' | 'ArrowUp'\n  ) => {\n    const grid = currentRow.parentElement?.closest('[role=\"grid\"]');\n    const allVisibleRows = grid?.querySelectorAll(\n      '[role=\"row\"]:not(.hds-advanced-table__tr--hidden)'\n    );\n\n    if (allVisibleRows) {\n      const currentRowIndex = Array.from(allVisibleRows).indexOf(currentRow);\n      if (direction === 'ArrowDown') return allVisibleRows[currentRowIndex + 1];\n      else if (direction === 'ArrowUp')\n        return allVisibleRows[currentRowIndex - 1];\n    }\n  };\n\n  if (\n    target instanceof HTMLElement &&\n    (target.classList.contains('hds-advanced-table__th') ||\n      target.classList.contains('hds-advanced-table__td'))\n  ) {\n    if (key === 'Enter') {\n      const cellFocusableChildren = focusable(target);\n\n      if (cellFocusableChildren.length > 0) {\n        for (let i = 0; i < cellFocusableChildren.length; i++) {\n          const child = cellFocusableChildren[i];\n          if (child?.hasAttribute('data-advanced-table-child-focusable')) {\n            child.setAttribute('tabindex', '0');\n          }\n        }\n        target.setAttribute('tabindex', '-1');\n        enableFocusTrap();\n      }\n    } else if (event.key === 'ArrowRight' || event.key === 'ArrowLeft') {\n      event.preventDefault();\n      const nextElement =\n        key === 'ArrowRight'\n          ? target.nextElementSibling\n          : target.previousElementSibling;\n\n      if (nextElement !== null && nextElement instanceof HTMLElement) {\n        changeActiveCell(target, nextElement);\n      }\n    } else if (event.key === 'ArrowDown' || event.key === 'ArrowUp') {\n      event.preventDefault();\n      const currentRow = target.parentElement;\n\n      if (currentRow instanceof HTMLElement) {\n        const currentCellIndex = Array.from(currentRow.children).indexOf(\n          target\n        );\n        const nextRow = findNewRow(currentRow, event.key);\n\n        if (nextRow !== null && nextRow instanceof HTMLElement) {\n          const nextCell = nextRow.children[currentCellIndex];\n          if (nextCell instanceof HTMLElement) {\n            changeActiveCell(target, nextCell);\n          }\n        }\n      }\n    } else if (event.key === 'Home' || event.key === 'End') {\n      event.preventDefault();\n      if (event.ctrlKey) {\n        const table = target.parentElement?.closest('[role=\"grid\"]');\n        const allVisibleRows = table?.querySelectorAll(\n          '[role=\"row\"]:not(.hds-advanced-table__tr--hidden)'\n        );\n\n        if (allVisibleRows) {\n          const nextRow =\n            key === 'Home'\n              ? allVisibleRows[0]\n              : allVisibleRows[allVisibleRows.length - 1];\n\n          if (nextRow) {\n            const cellsInNextRow = nextRow.children;\n            const nextElement =\n              key === 'Home'\n                ? cellsInNextRow[0]\n                : cellsInNextRow[cellsInNextRow.length - 1];\n\n            if (nextElement && nextElement instanceof HTMLElement) {\n              changeActiveCell(target, nextElement);\n            }\n          }\n        }\n      } else {\n        const currentRow = target.parentElement;\n\n        if (currentRow) {\n          const allCells = currentRow.children;\n          const nextElement =\n            key === 'Home' ? allCells[0] : allCells[allCells.length - 1];\n\n          if (nextElement && nextElement instanceof HTMLElement) {\n            changeActiveCell(target, nextElement);\n          }\n        }\n      }\n    } else if (event.key === 'PageUp' || event.key === 'PageDown') {\n      event.preventDefault();\n      const currentRow = target.parentElement;\n\n      if (currentRow instanceof HTMLElement) {\n        const currentCellIndex = Array.from(currentRow.children).indexOf(\n          target\n        );\n\n        const grid = currentRow.parentElement?.closest('[role=\"grid\"]');\n        const allVisibleRows = grid?.querySelectorAll(\n          '[role=\"row\"]:not(.hds-advanced-table__tr--hidden)'\n        );\n\n        if (allVisibleRows) {\n          const nextRow =\n            event.key === 'PageUp'\n              ? allVisibleRows[0]\n              : allVisibleRows[allVisibleRows.length - 1];\n\n          if (nextRow !== null && nextRow instanceof HTMLElement) {\n            const nextCell = nextRow.children[currentCellIndex];\n            if (nextCell instanceof HTMLElement) {\n              changeActiveCell(target, nextCell);\n            }\n          }\n        }\n      }\n    }\n  }\n};\n"],"names":["handleGridCellKeyPress","event","enableFocusTrap","key","target","changeActiveCell","oldCell","newCell","setAttribute","scrollIntoView","behavior","block","inline","focus","preventScroll","findNewRow","currentRow","direction","grid","parentElement","closest","allVisibleRows","querySelectorAll","currentRowIndex","Array","from","indexOf","HTMLElement","classList","contains","cellFocusableChildren","focusable","length","i","child","hasAttribute","preventDefault","nextElement","nextElementSibling","previousElementSibling","currentCellIndex","children","nextRow","nextCell","ctrlKey","table","cellsInNextRow","allCells"],"mappings":"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"}