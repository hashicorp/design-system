{"version":3,"file":"hds-tooltip.js","sources":["../../src/modifiers/hds-tooltip.ts"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\n// Note: the majority of this code is a porting of the existing tooltip implementation in Cloud UI\n// (which was initially implemented in Structure)\n\nimport Modifier from 'ember-modifier';\nimport type { ArgsFor } from 'ember-modifier';\n\nimport { assert } from '@ember/debug';\nimport { registerDestructor } from '@ember/destroyable';\n\nimport tippy, { followCursor } from 'tippy.js';\nimport type {\n  HideAll as TippyHideAll,\n  Instance as TippyInstance,\n  Props as TippyProps,\n} from 'tippy.js';\n// used by custom SVG arrow:\nimport 'tippy.js/dist/svg-arrow.css';\n\nexport interface HdsTooltipModifierSignature {\n  Args: {\n    Positional: [string];\n    Named: {\n      options?: Partial<TippyProps>;\n    };\n  };\n  Element: HTMLElement;\n}\n\nfunction cleanup(instance: HdsTooltipModifier): void {\n  const { _interval, _needsTabIndex, _tooltip } = instance;\n  if (_needsTabIndex) {\n    _tooltip?.reference?.removeAttribute('tabindex');\n  }\n  clearInterval(_interval);\n  _tooltip?.destroy();\n}\n\n/**\n *\n * `Tooltip` implements a modifier that uses Tippy.js to display a tooltip.\n *\n * Sample usage:\n * ```\n * <div {{hds-tooltip 'Text' options=(hash )}}>Hover me!</div>\n * ```\n *\n * @see https://atomiks.github.io/tippyjs\n * @class TooltipModifier\n *\n */\nexport default class HdsTooltipModifier extends Modifier<HdsTooltipModifierSignature> {\n  private _didSetup = false;\n  _interval: number | undefined = undefined;\n  _needsTabIndex = false;\n  _tooltip: TippyInstance | undefined = undefined;\n\n  constructor(owner: unknown, args: ArgsFor<HdsTooltipModifierSignature>) {\n    super(owner, args);\n    registerDestructor(this, cleanup);\n  }\n\n  hideOnEsc = {\n    name: 'hideOnEsc',\n    defaultValue: true,\n    fn({ hide }: { hide: TippyHideAll }) {\n      function onKeyDown(event: KeyboardEvent): void {\n        if (event.key === 'Escape') {\n          hide();\n        }\n      }\n\n      return {\n        onShow() {\n          document.addEventListener('keydown', onKeyDown);\n        },\n        onHide() {\n          document.removeEventListener('keydown', onKeyDown);\n        },\n      };\n    },\n  };\n\n  modify(\n    element: HdsTooltipModifierSignature['Element'],\n    positional: HdsTooltipModifierSignature['Args']['Positional'],\n    named: HdsTooltipModifierSignature['Args']['Named']\n  ): void {\n    assert('Tooltip must have an element', element);\n\n    if (!this._didSetup) {\n      this.#setup(element, positional, named);\n      this._didSetup = true;\n    }\n\n    this.#update(element, positional, named);\n  }\n\n  #setup(\n    element: HdsTooltipModifierSignature['Element'],\n    positional: HdsTooltipModifierSignature['Args']['Positional'],\n    named: HdsTooltipModifierSignature['Args']['Named']\n  ): void {\n    const tooltipProps = this.#getTooltipProps(element, positional, named);\n    this._tooltip = tippy(element, tooltipProps);\n  }\n\n  #update(\n    element: HdsTooltipModifierSignature['Element'],\n    positional: HdsTooltipModifierSignature['Args']['Positional'],\n    named: HdsTooltipModifierSignature['Args']['Named']\n  ): void {\n    const tooltipProps = this.#getTooltipProps(element, positional, named);\n    this._tooltip?.setProps(tooltipProps);\n  }\n\n  #getTooltipProps(\n    element: HdsTooltipModifierSignature['Element'],\n    positional: HdsTooltipModifierSignature['Args']['Positional'],\n    named: HdsTooltipModifierSignature['Args']['Named']\n  ): Partial<TippyProps> {\n    const { options } = named;\n    let [content] = positional;\n\n    let $anchor: HTMLElement | null = element; // Ensure $anchor can be null\n\n    if (typeof options?.triggerTarget === 'string') {\n      const $el = $anchor;\n      if (options.triggerTarget === 'parentNode') {\n        if ($anchor.parentNode instanceof HTMLElement) {\n          // Type guard\n          $anchor = $anchor.parentNode;\n        }\n      } else {\n        const queryResult: HTMLElement | null = $anchor.querySelector(\n          options.triggerTarget\n        );\n        if (queryResult) {\n          $anchor = queryResult;\n        }\n      }\n      if ($anchor instanceof HTMLElement) {\n        // Ensure $anchor is an HTMLElement before cloning\n        const clonedElement = $anchor.cloneNode(true) as HTMLElement; // Explicitly cast cloned node to HTMLElement\n        content = clonedElement.outerHTML; // Now safely access outerHTML\n      }\n      $el?.remove(); // Use optional chaining in case $el is null\n      options.triggerTarget = null;\n    }\n\n    // The {{hds-tooltip}} will just use the HTML content.\n    if (typeof content === 'undefined' && $anchor instanceof HTMLElement) {\n      // Ensure $anchor is an HTMLElement before accessing innerHTML\n      content = $anchor.innerHTML;\n      $anchor.innerHTML = '';\n    }\n\n    if (options?.trigger === 'manual') {\n      // If we are manually triggering, a out delay means only show for the\n      // amount of time specified by the delay.\n      const delay = options.delay || [];\n\n      if (Array.isArray(delay) && delay.length) {\n        if (typeof delay[1] !== 'undefined') {\n          options.onShown = (tooltip) => {\n            clearInterval(this._interval);\n            this._interval = setTimeout(() => {\n              tooltip.hide();\n            }, delay[1] ?? 0);\n          };\n        }\n      }\n    }\n\n    const $trigger = $anchor;\n\n    if (!$trigger.hasAttribute('tabindex')) {\n      this._needsTabIndex = true;\n      $trigger.setAttribute('tabindex', '0');\n    }\n\n    /*  Typescript does not like the previous approach of adding an undefined value\n     **  to the array and then filtering it out.\n     */\n    const plugins =\n      options?.followCursor !== undefined\n        ? [this.hideOnEsc, followCursor]\n        : [this.hideOnEsc];\n\n    return {\n      theme: 'hds',\n      triggerTarget: $trigger,\n      arrow: `\n        <svg class=\"hds-tooltip-pointer\" width=\"16\" height=\"7\" viewBox=\"0 0 16 7\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M0 7H16L9.11989 0.444571C8.49776 -0.148191 7.50224 -0.148191 6.88011 0.444572L0 7Z\" />\n        </svg>`,\n      // keeps tooltip itself open on hover:\n      interactive: true,\n      // fix accessibility features that get messed up with setting interactive: true\n      aria: {\n        content: 'describedby',\n        expanded: false,\n      },\n      content: () => content,\n      plugins,\n      ...options,\n    };\n  }\n}\n"],"names":["cleanup","instance","_interval","_needsTabIndex","_tooltip","reference","removeAttribute","clearInterval","destroy","_HdsTooltipModifier_brand","WeakSet","HdsTooltipModifier","Modifier","constructor","owner","args","_classPrivateMethodInitSpec","_defineProperty","undefined","name","defaultValue","fn","hide","onKeyDown","event","key","onShow","document","addEventListener","onHide","removeEventListener","registerDestructor","modify","element","positional","named","assert","_didSetup","_assertClassBrand","_setup","call","_update","tooltipProps","_getTooltipProps","tippy","setProps","options","content","$anchor","triggerTarget","$el","parentNode","HTMLElement","queryResult","querySelector","clonedElement","cloneNode","outerHTML","remove","innerHTML","trigger","delay","Array","isArray","length","onShown","tooltip","setTimeout","$trigger","hasAttribute","setAttribute","plugins","followCursor","hideOnEsc","theme","arrow","interactive","aria","expanded"],"mappings":"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"}