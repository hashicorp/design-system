{"version":3,"file":"hds-tooltip.js","sources":["../../src/modifiers/hds-tooltip.js"],"sourcesContent":["/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\n// Note: the majority of this code is a porting of the existing tooltip implementation in Cloud UI\n// (which was initially implemented in Structure)\n\nimport Modifier from 'ember-modifier';\nimport { assert } from '@ember/debug';\nimport { registerDestructor } from '@ember/destroyable';\n\nimport tippy, { followCursor } from 'tippy.js';\n// used by custom SVG arrow:\nimport 'tippy.js/dist/svg-arrow.css';\n\nfunction cleanup(instance) {\n  const { interval, needsTabIndex, tooltip } = instance;\n  if (needsTabIndex) {\n    tooltip?.reference?.removeAttribute('tabindex');\n  }\n  clearInterval(interval);\n  tooltip?.destroy();\n}\n\n/**\n *\n * `Tooltip` implements a modifier that uses Tippy.js to display a tooltip.\n *\n * Sample usage:\n * ```\n * <div {{hds-tooltip 'Text' options=(hash )}}>Hover me!</div>\n * ```\n *\n * @see https://atomiks.github.io/tippyjs\n * @class TooltipModifier\n *\n */\nexport default class HdsTooltipModifier extends Modifier {\n  didSetup = false;\n\n  interval = null;\n  needsTabIndex = false;\n  tooltip = null;\n\n  constructor(owner, args) {\n    super(owner, args);\n    registerDestructor(this, cleanup);\n  }\n\n  hideOnEsc = {\n    name: 'hideOnEsc',\n    defaultValue: true,\n    fn({ hide }) {\n      function onKeyDown(event) {\n        if (event.keyCode === 27) {\n          hide();\n        }\n      }\n\n      return {\n        onShow() {\n          document.addEventListener('keydown', onKeyDown);\n        },\n        onHide() {\n          document.removeEventListener('keydown', onKeyDown);\n        },\n      };\n    },\n  };\n\n  modify(element, positional, named) {\n    assert('Tooltip must have an element', element);\n\n    if (!this.didSetup) {\n      this.#setup(element, positional, named);\n      this.didSetup = true;\n    }\n\n    this.#update(element, positional, named);\n  }\n\n  #setup(element, positional, named) {\n    const tooltipProps = this.#getTooltipProps(element, positional, named);\n    this.tooltip = tippy(element, tooltipProps);\n  }\n\n  #update(element, positional, named) {\n    const tooltipProps = this.#getTooltipProps(element, positional, named);\n    this.tooltip.setProps(tooltipProps);\n  }\n\n  #getTooltipProps(element, positional, named) {\n    const { options = {} } = named;\n    let [content] = positional;\n\n    let $anchor = element;\n\n    // Make it easy to specify the modified element as the actual tooltip.\n    if (typeof options.triggerTarget === 'string') {\n      const $el = $anchor;\n      switch (options.triggerTarget) {\n        case 'parentNode':\n          $anchor = $anchor.parentNode;\n          break;\n        default:\n          $anchor = $anchor.querySelectorAll(options.triggerTarget);\n      }\n      content = $anchor.cloneNode(true);\n      $el.remove();\n      options.triggerTarget = undefined;\n    }\n\n    // The {{hds-tooltip}} will just use the HTML content.\n    if (typeof content === 'undefined') {\n      content = $anchor.innerHTML;\n      $anchor.innerHTML = '';\n    }\n\n    if (options.trigger === 'manual') {\n      // If we are manually triggering, a out delay means only show for the\n      // amount of time specified by the delay.\n      const delay = options.delay || [];\n\n      if (typeof delay[1] !== 'undefined') {\n        options.onShown = (tooltip) => {\n          clearInterval(this.interval);\n          this.interval = setTimeout(() => {\n            tooltip.hide();\n          }, delay[1]);\n        };\n      }\n    }\n\n    const $trigger = $anchor;\n\n    if (!$trigger.hasAttribute('tabindex')) {\n      this.needsTabIndex = true;\n      $trigger.setAttribute('tabindex', '0');\n    }\n\n    return {\n      theme: 'hds',\n      triggerTarget: $trigger,\n      arrow: `\n        <svg class=\"hds-tooltip-pointer\" width=\"16\" height=\"7\" viewBox=\"0 0 16 7\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M0 7H16L9.11989 0.444571C8.49776 -0.148191 7.50224 -0.148191 6.88011 0.444572L0 7Z\" />\n        </svg>`,\n      // keeps tooltip itself open on hover:\n      interactive: true,\n      // fix accessibility features that get messed up with setting interactive: true\n      aria: {\n        content: 'describedby',\n        expanded: null,\n      },\n      content: () => content,\n      plugins: [\n        typeof options.followCursor !== 'undefined' ? followCursor : undefined,\n        this.hideOnEsc,\n      ].filter((item) => Boolean(item)),\n      ...options,\n    };\n  }\n}\n"],"names":["cleanup","instance","interval","needsTabIndex","tooltip","reference","removeAttribute","clearInterval","destroy","_HdsTooltipModifier_brand","WeakSet","HdsTooltipModifier","Modifier","constructor","owner","args","_classPrivateMethodInitSpec","_defineProperty","name","defaultValue","fn","hide","onKeyDown","event","keyCode","onShow","document","addEventListener","onHide","removeEventListener","registerDestructor","modify","element","positional","named","assert","didSetup","_assertClassBrand","_setup","call","_update","tooltipProps","_getTooltipProps","tippy","setProps","options","content","$anchor","triggerTarget","$el","parentNode","querySelectorAll","cloneNode","remove","undefined","innerHTML","trigger","delay","onShown","setTimeout","$trigger","hasAttribute","setAttribute","theme","arrow","interactive","aria","expanded","plugins","followCursor","hideOnEsc","filter","item","Boolean"],"mappings":"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"}