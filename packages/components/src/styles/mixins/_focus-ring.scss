/**
 * Copyright IBM Corp. 2021, 2025
 * SPDX-License-Identifier: MPL-2.0
 */

// For an explanation of the ":focus/:focus-visible" states see:
// - https://github.com/hashicorp/design-system-components/issues/161
// - https://www.tpgi.com/focus-visible-and-backwards-compatibility/

// Private helper â€” conditionally wraps @content in &::before
/* stylelint-disable-next-line scss/at-mixin-pattern */
@mixin _hds-focus-ring-target($with-pseudo-element) {
  @if $with-pseudo-element {
    &::before {
      @content;
    }
  } @else {
    @content;
  }
}

@mixin hds-focus-ring(
  $focus-color: action,
  $border-color-initial: transparent,
  $border-color-active: $border-color-initial,
  $with-pseudo-element: false,
  $top: 0,
  $right: 0,
  $bottom: 0,
  $left: 0,
  $radius: var(--token-border-radius-small),
  $position: relative,
  // TODO we can remove also this argument, used only in a couple of places
  $is-focus-always-visible: false
) {
  // use a pseudo element to apply the focus to
  @if $with-pseudo-element {
    position: $position;
    outline-style: solid; // used to avoid double outline+focus-ring in Safari (see https://github.com/hashicorp/design-system-components/issues/161#issuecomment-1031548656)
    outline-color: transparent;
    isolation: isolate; // used to create a new stacking context (needed to have the pseudo element below text/icon but not the parent container)

    &::before {
      position: absolute;
      top: $top;
      right: $right;
      bottom: $bottom;
      left: $left;
      z-index: -1;
      border: 1px solid transparent;
      border-radius: $radius;
      content: "";
    }
  }

  // when focus should always be visible we use `:focus` (covers both keyboard and mouse)
  // otherwise we use the standard `:focus-visible` (keyboard-only)
  @if $is-focus-always-visible {
    &:focus,
    &.mock-focus {
      @include _hds-focus-ring-target($with-pseudo-element) {
        border-color: var(--token-color-focus-#{$focus-color}-internal);
        outline: 3px solid var(--token-color-focus-#{$focus-color}-external);
      }
    }
  } @else {
    &:focus-visible,
    &.mock-focus {
      @include _hds-focus-ring-target($with-pseudo-element) {
        border-color: var(--token-color-focus-#{$focus-color}-internal);
        outline: 3px solid var(--token-color-focus-#{$focus-color}-external);
      }
    }
  }

  // remove the focus ring on "active + focused" state (by design)
  &:focus:active,
  &.mock-focus.mock-active {
    @include _hds-focus-ring-target($with-pseudo-element) {
      border-color: $border-color-active;
      // outline: none;
    }
  }
}
