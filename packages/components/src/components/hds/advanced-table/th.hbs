{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: MPL-2.0
}}
<div
  class={{this.classNames}}
  role={{this.role}}
  aria-rowspan={{@rowspan}}
  aria-colspan={{@colspan}}
  aria-describedby={{@parentId}}
  {{style grid-row=this.rowspan grid-column=this.colspan padding-left=this.paddingLeft}}
  {{hds-advanced-table-cell
    handleEnableFocusTrap=this.enableFocusTrap
    shouldTrapFocus=this._shouldTrapFocus
    setCellElement=this.setElement
  }}
  {{! @glint-expect-error - https://github.com/josemarluedke/ember-focus-trap/issues/86 }}
  {{focus-trap
    isActive=this._shouldTrapFocus
    focusTrapOptions=(hash
      onDeactivate=this.onFocusTrapDeactivate initialFocus=this.getInitialFocus clickOutsideDeactivates=true
    )
  }}
  ...attributes
>
  <Hds::Layout::Flex @justify="space-between" @align="center" @gap="8">
    {{#if @column.isVisuallyHidden}}
      <span class="sr-only">{{yield}}</span>
    {{else}}
      {{#if @tooltip}}
        {{#if @isExpandable}}
          <Hds::AdvancedTable::ThButtonExpand
            @labelId={{this._labelId}}
            @onToggle={{@onClickToggle}}
            @isExpanded={{@isExpanded}}
            @isExpandAll={{@hasExpandAllButton}}
            {{this._manageExpandButton}}
          />
        {{/if}}
        <div class="hds-advanced-table__th-content">
          <span
            id={{this._labelId}}
            class="hds-advanced-table__th-content-text hds-typography-body-200 hds-font-weight-semibold"
          >
            {{yield}}
          </span>
          <Hds::AdvancedTable::ThButtonTooltip @tooltip={{@tooltip}} @labelId={{this._labelId}} />
        </div>
      {{else}}
        {{#if @isExpandable}}
          <Hds::AdvancedTable::ThButtonExpand
            @labelId={{this._labelId}}
            @onToggle={{@onClickToggle}}
            @isExpanded={{@isExpanded}}
            @isExpandAll={{@hasExpandAllButton}}
            {{this._manageExpandButton}}
          />
        {{/if}}
        <div class="hds-advanced-table__th-content">
          <span
            class="hds-advanced-table__th-content-text hds-typography-body-200 hds-font-weight-semibold"
            id={{this._labelId}}
          >{{yield}}</span>
        </div>
      {{/if}}
    {{/if}}

    {{#if @column}}
      {{#if (or @hasReorderableColumns this.showContextMenu)}}
        <Hds::Layout::Flex @justify="end" @align="center" @gap="8">
          {{#if @hasReorderableColumns}}
            <Hds::AdvancedTable::ThReorderHandle
              @column={{@column}}
              @columnWidth={{this._element.clientWidth}}
              @tableHeight={{@tableHeight}}
              @onReorderDragStart={{this.handleDragStart}}
              @onReorderDragEnd={{@onReorderDragEnd}}
            />
          {{/if}}

          {{#if this.showContextMenu}}
            <Hds::AdvancedTable::ThContextMenu
              @column={{@column}}
              @previousColumn={{@previousColumn}}
              @nextColumn={{@nextColumn}}
              @hasResizableColumns={{@hasResizableColumns}}
              @resizeHandleElement={{this._resizeHandleElement}}
              @onColumnResize={{@onColumnResize}}
            />
          {{/if}}
        </Hds::Layout::Flex>
      {{/if}}

      {{#if @hasResizableColumns}}
        <Hds::AdvancedTable::ThResizeHandle
          @column={{@column}}
          @nextColumn={{@nextColumn}}
          @hasResizableColumns={{@hasResizableColumns}}
          @tableHeight={{@tableHeight}}
          @onColumnResize={{@onColumnResize}}
          {{this._registerResizeHandleElement}}
        />
      {{/if}}

      {{#if (and @hasResizableColumns (not @isLastColumn))}}
        <Hds::AdvancedTable::ThResizeHandle
          @column={{@column}}
          @tableHeight={{@tableHeight}}
          @onColumnResize={{@onColumnResize}}
          {{this._registerResizeHandleElement}}
        />
      {{/if}}
    {{/if}}
  </Hds::Layout::Flex>

  {{#if @column.table.hasColumnBeingDragged}}
    <Hds::AdvancedTable::ThReorderDropTarget
      @column={{@column}}
      @tableHeight={{@tableHeight}}
      @onReorderDrop={{@onReorderDrop}}
    />
  {{/if}}
</div>