{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: MPL-2.0
}}
<div
  class={{this.classNames}}
  aria-sort={{this.ariaSort}}
  role="columnheader"
  aria-rowspan={{@rowspan}}
  aria-colspan={{@colspan}}
  {{hds-advanced-table-cell
    handleEnableFocusTrap=this.enableFocusTrap
    shouldTrapFocus=this._shouldTrapFocus
    setCellElement=this.setElement
  }}
  {{! @glint-expect-error - https://github.com/josemarluedke/ember-focus-trap/issues/86 }}
  {{focus-trap
    isActive=this._shouldTrapFocus
    focusTrapOptions=(hash
      onDeactivate=this.onFocusTrapDeactivate initialFocus=this.getInitialFocus clickOutsideDeactivates=true
    )
  }}
  ...attributes
>
  <Hds::Layout::Flex @justify="space-between" @align="center" @gap="8">
    <div class="hds-advanced-table__th-content">
      <span
        id={{this._labelId}}
        class="hds-advanced-table__th-content-text hds-typography-body-200 hds-font-weight-semibold"
      >
        {{yield}}
      </span>

      {{#if @tooltip}}
        <Hds::AdvancedTable::ThButtonTooltip @tooltip={{@tooltip}} @labelId={{this._labelId}} />
      {{/if}}
      {{#if (gt this.numFilters 0)}}
        <Hds::BadgeCount @text={{this.numFilters}} @type="outlined" @size="small" />
      {{/if}}
    </div>

    <Hds::Layout::Flex class="hds-advanced-table__th-actions" @align="center" @gap="8">
      <Hds::AdvancedTable::ThButtonSort
        @sortOrder={{@sortOrder}}
        @onClick={{@onClickSort}}
        @labelId={{this._labelId}}
      />

      {{#if @column}}
        {{#if @column.filterOptions}}
          <Hds::AdvancedTable::ThFilterMenu
            @column={{@column}}
            @filters={{@filters}}
            @isLiveFilter={{@isLiveFilter}}
            @onFilter={{@onFilter}}
          />
        {{/if}}

        <Hds::AdvancedTable::ThContextMenu
          @column={{@column}}
          @hasReorderableColumns={{@hasReorderableColumns}}
          @hasResizableColumns={{@hasResizableColumns}}
          @isStickyColumn={{@isStickyColumn}}
          @reorderHandleElement={{this._reorderHandleElement}}
          @resizeHandleElement={{this._resizeHandleElement}}
          @onColumnResize={{@onColumnResize}}
          @onPinFirstColumn={{@onPinFirstColumn}}
        />

        {{#if (and @hasReorderableColumns (not @isStickyColumn))}}
          <Hds::AdvancedTable::ThReorderHandle
            @column={{@column}}
            @tableHeight={{@tableHeight}}
            @onReorderDragStart={{this.handleDragStart}}
            @onReorderDragEnd={{@onReorderDragEnd}}
            {{this._registerReorderHandleElement}}
          />
        {{/if}}

        {{#if (and @hasResizableColumns (not @column.isLast) (not @column.table.hasColumnBeingDragged))}}
          <Hds::AdvancedTable::ThResizeHandle
            @column={{@column}}
            @tableHeight={{@tableHeight}}
            @onColumnResize={{@onColumnResize}}
            {{this._registerResizeHandleElement}}
          />
        {{/if}}
      {{/if}}
    </Hds::Layout::Flex>
  </Hds::Layout::Flex>

  {{#if @column}}
    {{#if (and @column.table.hasColumnBeingDragged (not @isStickyColumn))}}
      <Hds::AdvancedTable::ThReorderDropTarget
        @column={{@column}}
        @hasSelectableRows={{@hasSelectableRows}}
        @tableHeight={{@tableHeight}}
        @onReorderDrop={{@onReorderDrop}}
      />
    {{/if}}
  {{/if}}
</div>